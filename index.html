<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlogMind AI v5 â€” Ù†Ø§Ø´Ø± Ø¨Ù„ÙˆØ¬Ø± | OpenRouter Ù…Ø¬Ø§Ù†ÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --ink:#050c1a; --ink2:#0d1f3c; --ink3:#162d52;
  --surf:#0f1e38; --surf2:#152644; --surf3:#1c3258;
  --line:rgba(255,255,255,0.07); --line2:rgba(255,255,255,0.12);
  --cyan:#00e5ff; --cyan2:#00b8d4; --green:#00e676;
  --amber:#ffd740; --rose:#ff4081; --purple:#b388ff;
  --text:#e8f4fd; --text2:#7ea8d0; --text3:#3d6488;
  --mono:'Space Mono',monospace; --sans:'Readex Pro',sans-serif;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--sans);background:var(--ink);color:var(--text);min-height:100vh;overflow-x:hidden;
  background-image:radial-gradient(ellipse 80% 50% at 0% 0%,rgba(0,229,255,.06) 0%,transparent 60%),
    radial-gradient(ellipse 60% 60% at 100% 100%,rgba(0,230,118,.05) 0%,transparent 60%);}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--ink2);}
::-webkit-scrollbar-thumb{background:var(--cyan2);border-radius:2px;}

/* ===== NAV ===== */
nav{position:sticky;top:0;z-index:200;background:rgba(5,12,26,.93);backdrop-filter:blur(20px);
  border-bottom:1px solid var(--line2);padding:0 28px;height:58px;
  display:flex;align-items:center;justify-content:space-between;}
.nav-brand{display:flex;align-items:center;gap:10px;}
.nav-icon{width:32px;height:32px;background:var(--cyan);border-radius:8px;display:flex;
  align-items:center;justify-content:center;font-size:15px;color:var(--ink);font-weight:700;font-family:var(--mono);}
.nav-name{font-size:15px;font-weight:700;} .nav-name span{color:var(--cyan);}
.nav-v{font-size:10px;color:var(--text3);font-family:var(--mono);margin-right:6px;margin-top:2px;}
.nav-pills{display:flex;gap:3px;}
.npill{padding:5px 14px;border-radius:6px;background:transparent;border:1px solid transparent;
  color:var(--text2);font-family:var(--sans);font-size:12px;cursor:pointer;transition:all .2s;}
.npill:hover{color:var(--text);border-color:var(--line2);}
.npill.active{background:var(--surf2);border-color:var(--cyan);color:var(--cyan);}
.ai-badge{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text2);font-family:var(--mono);}
.pdot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.3)}}

/* ===== LAYOUT ===== */
.app{display:grid;grid-template-columns:310px 1fr;min-height:calc(100vh - 58px);}
.panel{background:var(--ink2);border-left:1px solid var(--line2);overflow-y:auto;
  max-height:calc(100vh - 58px);position:sticky;top:58px;}
.psec{padding:18px 20px;border-bottom:1px solid var(--line);}
.ph{display:flex;align-items:center;gap:8px;font-size:10px;font-weight:600;color:var(--text3);
  letter-spacing:2px;text-transform:uppercase;margin-bottom:14px;font-family:var(--mono);}
.ph::before{content:'';width:10px;height:2px;background:var(--cyan);display:block;}
.ph.purple::before{background:var(--purple);}
.ph.amber::before{background:var(--amber);}
.ph.green::before{background:var(--green);}

/* ===== FIELDS ===== */
.field{margin-bottom:13px;}
.flabel{font-size:11px;font-weight:500;color:var(--text2);margin-bottom:5px;
  display:flex;align-items:center;justify-content:space-between;}
.fhint{font-size:10px;color:var(--text3);font-family:var(--mono);}
input[type=text],input[type=password],textarea,select{
  width:100%;background:var(--surf3);border:1px solid var(--line2);color:var(--text);
  border-radius:8px;padding:9px 12px;font-family:var(--sans);font-size:13px;transition:all .2s;outline:none;-webkit-appearance:none;}
input:focus,textarea:focus,select:focus{border-color:var(--cyan);box-shadow:0 0 0 3px rgba(0,229,255,.1);background:var(--ink3);}
input::placeholder,textarea::placeholder{color:var(--text3);}
select option{background:var(--ink2);}
.isec{position:relative;} .isec input{padding-left:34px;}
.eye{position:absolute;left:9px;top:50%;transform:translateY(-50%);background:none;border:none;
  color:var(--text3);cursor:pointer;font-size:14px;transition:color .2s;}
.eye:hover{color:var(--cyan);}

/* ===== TAGS ===== */
.tagwrap{background:var(--surf3);border:1px solid var(--line2);border-radius:8px;padding:6px 10px;
  display:flex;flex-wrap:wrap;gap:4px;min-height:36px;cursor:text;transition:all .2s;}
.tagwrap:focus-within{border-color:var(--cyan);box-shadow:0 0 0 3px rgba(0,229,255,.1);}
.chip{background:rgba(0,229,255,.12);border:1px solid rgba(0,229,255,.3);color:var(--cyan);
  border-radius:4px;padding:1px 6px;font-size:11px;display:flex;align-items:center;gap:3px;}
.chip.purple-chip{background:rgba(179,136,255,.12);border-color:rgba(179,136,255,.3);color:var(--purple);}
.chipx{cursor:pointer;font-size:13px;opacity:.6;} .chipx:hover{opacity:1;color:var(--rose);}
.tagbare{background:transparent;border:none;outline:none;color:var(--text);font-size:12px;
  flex:1;min-width:60px;font-family:var(--sans);}

/* ===== TONE / LANG GRIDS ===== */
.lang-btns,.tone-grid{display:flex;gap:4px;flex-wrap:wrap;}
.lbtn,.tbtn{flex:1;min-width:60px;padding:7px 6px;background:var(--surf3);border:1px solid var(--line2);
  border-radius:7px;color:var(--text2);font-family:var(--sans);font-size:11px;font-weight:500;
  cursor:pointer;text-align:center;transition:all .18s;}
.lbtn:hover,.tbtn:hover{border-color:var(--cyan);color:var(--text);}
.lbtn.on,.tbtn.on{background:rgba(0,229,255,.1);border-color:var(--cyan);color:var(--cyan);}

/* ===== SLIDER ===== */
.strack{padding:4px 0;}
input[type=range]{-webkit-appearance:none;width:100%;height:3px;background:var(--line2);
  border:none;border-radius:3px;padding:0;cursor:pointer;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:15px;height:15px;
  background:var(--cyan);border-radius:50%;box-shadow:0 0 8px var(--cyan);}
.slbls{display:flex;justify-content:space-between;font-size:9px;color:var(--text3);
  margin-top:4px;font-family:var(--mono);}

/* ===== TOGGLES ===== */
.trow{display:flex;align-items:center;justify-content:space-between;padding:8px 0;
  border-bottom:1px solid var(--line);}
.trow:last-child{border-bottom:none;}
.tlbl{font-size:12px;color:var(--text);display:flex;align-items:center;gap:6px;}
.toggler{width:36px;height:20px;background:var(--surf3);border:1px solid var(--line2);
  border-radius:10px;position:relative;cursor:pointer;transition:all .3s;outline:none;}
.toggler::after{content:'';position:absolute;width:14px;height:14px;background:var(--text3);
  border-radius:50%;top:2px;right:2px;transition:all .3s;}
.toggler.on{background:rgba(0,230,118,.2);border-color:var(--green);}
.toggler.on::after{background:var(--green);transform:translateX(-16px);box-shadow:0 0 8px var(--green);}

/* ===== ADVANCED MODE BADGE ===== */
.adv-badge{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;
  background:rgba(179,136,255,.15);border:1px solid rgba(179,136,255,.35);
  border-radius:20px;font-size:10px;font-family:var(--mono);color:var(--purple);margin-bottom:10px;}
.adv-on{background:rgba(179,136,255,.25);border-color:var(--purple);box-shadow:0 0 12px rgba(179,136,255,.2);}

/* ===== ADVANCED FIELDS ===== */
.adv-block{background:rgba(179,136,255,.05);border:1px solid rgba(179,136,255,.15);
  border-radius:10px;padding:14px;margin-top:10px;display:none;}
.adv-block.shown{display:block;}
.adv-section{margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid rgba(179,136,255,.1);}
.adv-section:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0;}
.adv-title{font-size:10px;color:var(--purple);font-family:var(--mono);letter-spacing:1px;
  text-transform:uppercase;margin-bottom:8px;display:flex;align-items:center;gap:6px;}
.adv-title::before{content:'â–¸';font-size:8px;}
.kw-grid{display:grid;grid-template-columns:1fr 1fr;gap:5px;}
.kw-input-wrap{position:relative;}
.kw-num{position:absolute;right:8px;top:50%;transform:translateY(-50%);
  font-size:9px;color:var(--text3);font-family:var(--mono);}
.kw-input-wrap input{padding-right:28px;font-size:12px;}

/* ===== WORKSPACE ===== */
.workspace{padding:24px;overflow-y:auto;}
.wsec{display:none;} .wsec.active{display:block;}
.wsh{font-size:10px;color:var(--text3);letter-spacing:2px;text-transform:uppercase;
  font-family:var(--mono);margin-bottom:16px;display:flex;align-items:center;gap:10px;}
.wsh::after{content:'';flex:1;height:1px;background:var(--line2);}

/* ===== GEN ZONE ===== */
.genzone{background:linear-gradient(135deg,var(--surf) 0%,var(--ink2) 100%);
  border:1px solid var(--line2);border-radius:14px;padding:20px;margin-bottom:18px;
  position:relative;overflow:hidden;}
.genzone::before{content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(0,229,255,.03),rgba(179,136,255,.02));pointer-events:none;}
.genbtn{width:100%;padding:15px;background:linear-gradient(135deg,var(--cyan),#00b8d4);
  border:none;border-radius:11px;color:var(--ink);font-family:var(--sans);font-size:14px;
  font-weight:700;cursor:pointer;transition:all .3s;display:flex;align-items:center;
  justify-content:center;gap:10px;box-shadow:0 0 25px rgba(0,229,255,.3);position:relative;overflow:hidden;}
.genbtn::after{content:'';position:absolute;top:-50%;left:-60%;width:40%;height:200%;
  background:rgba(255,255,255,.15);transform:skewX(-20deg);transition:left .5s;}
.genbtn:hover::after{left:120%;} .genbtn:hover{transform:translateY(-2px);box-shadow:0 0 40px rgba(0,229,255,.45);}
.genbtn:disabled{opacity:.5;cursor:not-allowed;transform:none;}
.genbtn.adv-mode{background:linear-gradient(135deg,#7c4dff,#b388ff);}
.genbtn.adv-mode:hover{box-shadow:0 0 40px rgba(179,136,255,.45);}

/* ===== MODE INDICATOR ===== */
.mode-bar{display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;
  background:var(--surf3);border-radius:8px;border:1px solid var(--line2);}
.mode-dot{width:8px;height:8px;border-radius:50%;}
.mode-dot.std{background:var(--cyan);box-shadow:0 0 6px var(--cyan);}
.mode-dot.adv{background:var(--purple);box-shadow:0 0 6px var(--purple);}
.mode-txt{font-size:11px;color:var(--text2);font-family:var(--mono);}
.mode-feat{display:flex;gap:6px;margin-right:auto;}
.mfeat{font-size:9px;padding:2px 7px;border-radius:10px;font-family:var(--mono);}
.mfeat.c{background:rgba(0,229,255,.1);color:var(--cyan);border:1px solid rgba(0,229,255,.2);}
.mfeat.p{background:rgba(179,136,255,.1);color:var(--purple);border:1px solid rgba(179,136,255,.2);}
.mfeat.g{background:rgba(0,230,118,.1);color:var(--green);border:1px solid rgba(0,230,118,.2);}
.mfeat.a{background:rgba(255,215,64,.1);color:var(--amber);border:1px solid rgba(255,215,64,.2);}

/* ===== STATS ===== */
.statsrow{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;}
.sbadge{background:var(--ink2);border:1px solid var(--line2);border-radius:6px;
  padding:4px 10px;font-size:11px;color:var(--text2);display:flex;align-items:center;
  gap:4px;font-family:var(--mono);}
.sbadge b{color:var(--cyan);font-weight:700;}
.sbadge.g b{color:var(--green);} .sbadge.a b{color:var(--amber);}

/* ===== ARTICLE CARD ===== */
.artcard{background:var(--surf);border:1px solid var(--line2);border-radius:14px;
  overflow:hidden;margin-bottom:18px;}
.arthead{padding:12px 18px;border-bottom:1px solid var(--line);
  display:flex;align-items:center;justify-content:space-between;background:var(--ink2);}
.arttitle{font-size:11px;font-weight:600;color:var(--text2);letter-spacing:1px;
  text-transform:uppercase;font-family:var(--mono);display:flex;align-items:center;gap:8px;}
.arttabs{display:flex;gap:3px;}
.atab{padding:4px 11px;background:transparent;border:1px solid transparent;border-radius:5px;
  color:var(--text3);font-family:var(--mono);font-size:10px;cursor:pointer;transition:all .15s;}
.atab.on{border-color:var(--line2);color:var(--text2);background:var(--surf3);}
.artbody{padding:22px;min-height:360px;max-height:500px;overflow-y:auto;font-size:14px;line-height:1.9;}

/* Empty / Loader */
.estate{display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:320px;color:var(--text3);gap:10px;}
.eicon{font-size:42px;filter:grayscale(1) opacity(.3);}
.loader{display:flex;flex-direction:column;align-items:center;justify-content:center;height:320px;gap:16px;}
.lring{width:44px;height:44px;border:2px solid var(--line2);border-top-color:var(--cyan);
  border-radius:50%;animation:spin .7s linear infinite;}
.lring.purple{border-top-color:var(--purple);}
@keyframes spin{to{transform:rotate(360deg)}}
.lmsg{font-size:12px;color:var(--text2);font-family:var(--mono);}
.lsub{font-size:10px;color:var(--text3);font-family:var(--mono);animation:blink 1.5s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.lprog{display:flex;flex-direction:column;gap:6px;margin-top:8px;width:240px;}
.lpstep{font-size:10px;font-family:var(--mono);display:flex;align-items:center;gap:6px;}
.lpstep .dot{width:6px;height:6px;border-radius:50%;background:var(--text3);}
.lpstep.done .dot{background:var(--green);box-shadow:0 0 6px var(--green);}
.lpstep.active .dot{background:var(--cyan);box-shadow:0 0 6px var(--cyan);animation:pulse 1s infinite;}

/* Article HTML preview */
.artbody h1{font-size:20px;color:var(--cyan);margin-bottom:14px;font-weight:700;line-height:1.4;}
.artbody h2{font-size:16px;color:#ff6b6b;margin:20px 0 9px;font-weight:600;}
.artbody h3{font-size:14px;color:#4a90d9;margin:14px 0 7px;font-weight:600;}
.artbody p{margin-bottom:12px;color:var(--text);}
.artbody strong{color:var(--amber);}
.artbody em{color:var(--cyan2);}
.artbody ul,.artbody ol{margin:8px 0 12px 18px;}
.artbody li{margin-bottom:5px;color:var(--text);font-size:13px;}
.artbody blockquote{border-right:3px solid var(--cyan);padding:8px 14px;
  background:rgba(0,229,255,.05);border-radius:0 8px 8px 0;margin:12px 0;color:var(--text2);font-style:italic;}
.artbody a[href=""]{pointer-events:none;color:var(--cyan);text-decoration:underline;}
.artbody img{width:100%;border-radius:8px;margin:12px 0;max-height:200px;object-fit:cover;border:1px solid var(--line2);}

/* ===== SEO CARD ===== */
.seocard{background:var(--surf);border:1px solid rgba(0,229,255,.15);border-radius:14px;
  padding:18px;margin-bottom:18px;display:none;}
.seocard.shown{display:block;}
.seoring{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-family:var(--mono);font-size:13px;font-weight:700;border:3px solid var(--green);
  color:var(--green);box-shadow:0 0 12px rgba(0,230,118,.3);}
.seor{display:flex;gap:12px;align-items:flex-start;margin-bottom:9px;padding-bottom:9px;
  border-bottom:1px solid var(--line);}
.seor:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0;}
.seok{font-size:10px;font-family:var(--mono);color:var(--text3);text-transform:uppercase;
  letter-spacing:1px;min-width:65px;padding-top:2px;}
.seov{font-size:12px;color:var(--text);line-height:1.6;}

/* ===== IMAGES ===== */
.imgcard{background:var(--surf);border:1px solid var(--line2);border-radius:14px;
  padding:18px;margin-bottom:18px;display:none;}
.imgcard.shown{display:block;}
.imggrid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px;}
.imgopt{border-radius:7px;overflow:hidden;border:2px solid transparent;cursor:pointer;
  transition:all .2s;aspect-ratio:16/9;background:var(--ink2);position:relative;}
.imgopt img{width:100%;height:100%;object-fit:cover;display:block;}
.imgopt:hover{border-color:var(--cyan);transform:scale(1.02);}
.imgopt.chosen{border-color:var(--green);}
.imgchk{position:absolute;top:5px;left:5px;background:var(--green);color:var(--ink);
  border-radius:4px;padding:1px 6px;font-size:9px;font-weight:700;font-family:var(--mono);display:none;}
.imgopt.chosen .imgchk{display:block;}

/* ===== ACTIONS ===== */
.actrow{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px;}
.btnpub{padding:10px 20px;background:linear-gradient(135deg,var(--green),#00c853);
  border:none;border-radius:9px;color:var(--ink);font-family:var(--sans);font-size:13px;
  font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px;
  box-shadow:0 0 18px rgba(0,230,118,.25);}
.btnpub:hover{transform:translateY(-2px);box-shadow:0 0 28px rgba(0,230,118,.4);}
.btnpub:disabled{opacity:.5;cursor:not-allowed;transform:none;}
.btng{padding:10px 16px;background:var(--surf);border:1px solid var(--line2);border-radius:9px;
  color:var(--text2);font-family:var(--sans);font-size:13px;cursor:pointer;
  transition:all .2s;display:flex;align-items:center;gap:6px;}
.btng:hover{border-color:var(--cyan);color:var(--cyan);}

/* ===== HISTORY ===== */
.hcard{background:var(--surf);border:1px solid var(--line2);border-radius:9px;
  padding:12px 16px;margin-bottom:7px;cursor:pointer;transition:all .2s;
  display:flex;align-items:center;justify-content:space-between;}
.hcard:hover{border-color:var(--cyan);transform:translateX(-3px);}
.htitle{font-size:13px;font-weight:600;margin-bottom:4px;}
.hmeta{display:flex;gap:10px;font-size:10px;color:var(--text3);font-family:var(--mono);}
.badge{padding:2px 8px;border-radius:4px;font-size:9px;font-weight:700;font-family:var(--mono);text-transform:uppercase;}
.bp{background:rgba(0,230,118,.15);color:var(--green);border:1px solid rgba(0,230,118,.3);}
.bd{background:rgba(255,215,64,.15);color:var(--amber);border:1px solid rgba(255,215,64,.3);}
.bs{background:rgba(0,229,255,.15);color:var(--cyan);border:1px solid rgba(0,229,255,.3);}

/* ===== MODAL ===== */
.moverlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(6px);
  z-index:300;display:none;align-items:center;justify-content:center;}
.moverlay.open{display:flex;}
.modal{background:var(--ink2);border:1px solid var(--line2);border-radius:14px;
  padding:26px;max-width:460px;width:90%;animation:fadeUp .3s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
.modal h3{font-size:15px;margin-bottom:8px;} .modal p{font-size:13px;color:var(--text2);margin-bottom:18px;line-height:1.7;}
.mbtns{display:flex;gap:8px;}

/* ===== TOAST ===== */
.toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%) translateY(80px);
  background:var(--ink2);border:1px solid var(--green);border-radius:9px;
  padding:9px 18px;font-size:13px;color:var(--text);display:flex;align-items:center;gap:7px;
  box-shadow:0 0 22px rgba(0,230,118,.25);transition:transform .35s cubic-bezier(.34,1.56,.64,1);
  z-index:999;white-space:nowrap;}
.toast.up{transform:translateX(-50%) translateY(0);}
.toast.err{border-color:var(--rose);box-shadow:0 0 22px rgba(255,64,129,.25);}

/* ===== SCHED BOX ===== */
.schedbox{background:rgba(255,215,64,.04);border:1px solid rgba(255,215,64,.15);
  border-radius:8px;padding:11px;margin-top:9px;display:none;}
.schedbox.shown{display:block;}
input[type=datetime-local]{color-scheme:dark;}

/* ===== SETTINGS CARDS ===== */
.setcard{background:var(--surf);border:1px solid var(--line2);border-radius:12px;overflow:hidden;margin-bottom:14px;}
.sethead{padding:12px 18px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:8px;
  background:var(--ink2);font-size:11px;font-weight:600;color:var(--text2);letter-spacing:1px;
  text-transform:uppercase;font-family:var(--mono);}
.setbody{padding:18px;}
.setdot{width:7px;height:7px;border-radius:50%;}
.tip-box{background:rgba(0,229,255,.04);border:1px solid rgba(0,229,255,.1);border-radius:8px;
  padding:12px;font-size:11px;color:var(--text3);font-family:var(--mono);line-height:1.8;margin-top:12px;}
.guide-step{display:flex;align-items:flex-start;gap:10px;}
.gs-num{width:22px;height:22px;min-width:22px;border-radius:50%;background:rgba(0,229,255,.15);
  border:1px solid rgba(0,229,255,.3);color:var(--cyan);font-size:11px;font-weight:700;
  font-family:var(--mono);display:flex;align-items:center;justify-content:center;margin-top:1px;}
.gs-txt{font-size:12px;color:var(--text);line-height:1.7;}

/* VERIFY ROWS */
.vrow{display:flex;align-items:center;gap:12px;padding:12px;background:var(--ink2);
  border-radius:10px;border:1px solid var(--line2);transition:border-color .3s;}
.vrow.ok{border-color:rgba(0,230,118,.3);background:rgba(0,230,118,.04);}
.vrow.fail{border-color:rgba(255,64,129,.3);background:rgba(255,64,129,.04);}
.vrow.checking{border-color:rgba(255,215,64,.2);}
.vicon{font-size:22px;min-width:28px;text-align:center;}
.vinfo{flex:1;}
.vtitle{font-size:12px;font-weight:600;color:var(--text);margin-bottom:3px;}
.vdetail{font-size:11px;color:var(--text3);font-family:var(--mono);line-height:1.5;}
.vstatus{font-size:11px;font-family:var(--mono);font-weight:700;white-space:nowrap;}

@media(max-width:860px){.app{grid-template-columns:1fr;}.panel{position:static;max-height:none;order:2;}.workspace{order:1;}}
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-brand">
    <div class="nav-icon">B</div>
    <div>
      <div class="nav-name">Blog<span>Mind</span> AI <span class="nav-v">v5</span></div>
    </div>
  </div>
  <div class="nav-pills">
    <button class="npill active" onclick="showSec('write',this)">âœï¸ ÙƒØªØ§Ø¨Ø©</button>
    <button class="npill" onclick="showSec('history',this)">ğŸ“š Ø§Ù„Ø³Ø¬Ù„</button>
    <button class="npill" onclick="showSec('guide',this)">ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙØ§ØªÙŠØ­</button>
    <button class="npill" onclick="showSec('settings',this)">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </div>
  <div class="ai-badge">
    <div class="pdot" style="background:#10b981;box-shadow:0 0 8px #10b981;"></div>
    <span style="color:#10b981;">OpenRouter âœ¦ Ù…Ø¬Ø§Ù†ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ø¨Ù„Ø§Ø¯</span>
  </div>
</nav>

<div class="app">

<!-- ===== PANEL ===== -->
<div class="panel">

  <!-- Basic Info -->
  <div class="psec">
    <div class="ph">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù‚Ø§Ù„</div>
    <div class="field">
      <div class="flabel">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ / Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ Ø§Ù„Ù„Ø¹Ø¨Ø© <span class="fhint">*</span></div>
      <textarea id="topic" rows="2" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø¹Ø¨Ø© PUBG Mobile â€” ØªØ·Ø¨ÙŠÙ‚ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª..."></textarea>
    </div>
    <div class="field">
      <div class="flabel">Ø§Ù„ØªØµÙ†ÙŠÙ</div>
      <input type="text" id="cat" placeholder="Ø£Ù„Ø¹Ø§Ø¨ â€” ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ â€” ØªÙ‚Ù†ÙŠØ©...">
    </div>
    <div class="field">
      <div class="flabel">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</div>
      <select id="target-cat">
        <option value="Ù…Ø³ØªØ®Ø¯Ù…Ùˆ Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯">Ù…Ø³ØªØ®Ø¯Ù…Ùˆ Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯</option>
        <option value="Ù„Ø§Ø¹Ø¨ÙˆÙ†">Ù„Ø§Ø¹Ø¨ÙˆÙ†</option>
        <option value="Ù…Ø¨ØªØ¯Ø¦ÙˆÙ†">Ù…Ø¨ØªØ¯Ø¦ÙˆÙ†</option>
        <option value="Ù…Ø·ÙˆØ±ÙˆÙ†">Ù…Ø·ÙˆØ±ÙˆÙ†</option>
        <option value="Ø¹Ø§Ù…">Ø¬Ù…Ù‡ÙˆØ± Ø¹Ø§Ù…</option>
      </select>
    </div>
  </div>

  <!-- Language & Tone -->
  <div class="psec">
    <div class="ph">Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ÙƒØªØ§Ø¨Ø©</div>
    <div class="field">
      <div class="flabel">Ø§Ù„Ù„ØºØ©</div>
      <div class="lang-btns">
        <button class="lbtn on" onclick="setLang('ar',this)">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</button>
        <button class="lbtn" onclick="setLang('en',this)">ğŸ‡¬ğŸ‡§ English</button>
        <button class="lbtn" onclick="setLang('bi',this)">ğŸŒ Ø«Ù†Ø§Ø¦ÙŠ</button>
      </div>
    </div>
    <div class="field">
      <div class="flabel">Ø§Ù„Ù†Ø¨Ø±Ø©</div>
      <div class="tone-grid">
        <button class="tbtn on" onclick="setTone('Ø¨Ø³ÙŠØ· ÙˆØ·Ø¨ÙŠØ¹ÙŠ',this)">ğŸ˜Š Ø¨Ø³ÙŠØ·</button>
        <button class="tbtn" onclick="setTone('Ø§Ø­ØªØ±Ø§ÙÙŠ',this)">ğŸ’¼ Ø§Ø­ØªØ±Ø§ÙÙŠ</button>
        <button class="tbtn" onclick="setTone('ØªØ¹Ù„ÙŠÙ…ÙŠ',this)">ğŸ“š ØªØ¹Ù„ÙŠÙ…ÙŠ</button>
        <button class="tbtn" onclick="setTone('ØªØ³ÙˆÙŠÙ‚ÙŠ',this)">ğŸ¯ ØªØ³ÙˆÙŠÙ‚ÙŠ</button>
      </div>
    </div>
    <div class="field">
      <div class="flabel">Ø·ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„: <span id="len-lbl" style="color:var(--cyan);font-family:var(--mono)">1200 ÙƒÙ„Ù…Ø©</span></div>
      <div class="strack">
        <input type="range" id="len-sl" min="1" max="3" value="2" step="1" oninput="onLen(this.value)">
        <div class="slbls"><span>800</span><span>1200</span><span>1800+</span></div>
      </div>
    </div>
  </div>

  <!-- ğŸ”¥ ADVANCED MODE -->
  <div class="psec">
    <div class="ph purple">âš¡ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (AdSense)</div>

    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
      <div>
        <div class="adv-badge" id="adv-badge">ğŸ”’ Ø¥ÙŠÙ‚Ø§Ù</div>
        <div style="font-size:11px;color:var(--text3);margin-top:4px;">Ù…Ù‚Ø§Ù„ Ø¢Ù…Ù† Ù„Ù€ AdSense + SEO Ù…Ø­ØªØ±Ù</div>
      </div>
      <button class="toggler" id="t-adv" onclick="toggleAdv()"></button>
    </div>

    <div class="adv-block" id="adv-block">

      <!-- Keywords -->
      <div class="adv-section">
        <div class="adv-title">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ø­ØªÙ‰ 8)</div>
        <div class="kw-grid" id="kw-grid">
          <!-- generated dynamically -->
        </div>
        <div style="font-size:10px;color:var(--text3);margin-top:6px;font-family:var(--mono);">
          K1 â†’ H1 | K2-K3 â†’ H2 | K4-K5 â†’ H3 | K6-K8 â†’ ÙÙ‚Ø±Ø§Øª
        </div>
      </div>

      <!-- Related Articles -->
      <div class="adv-section">
        <div class="adv-title">Ù…Ù‚Ø§Ù„Ø§Øª Ù…Ù‚ØªØ±Ø­Ø© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</div>
        <div class="field" style="margin-bottom:8px;">
          <input type="text" id="rel1" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„...">
        </div>
        <div class="field" style="margin-bottom:0;">
          <input type="text" id="rel2" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ...">
        </div>
      </div>

      <!-- Blog Name -->
      <div class="adv-section">
        <div class="adv-title">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙˆÙ†Ø© (Ù„Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©)</div>
        <input type="text" id="blogname" placeholder="Ù…Ø«Ø§Ù„: ØªÙƒ Ø¹Ø±Ø¨ÙŠ">
      </div>

      <!-- Download link -->
      <div class="adv-section">
        <div class="adv-title">Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>
        <input type="text" id="dl-link" placeholder="https://play.google.com/...">
        <div style="font-size:10px;color:var(--text3);margin-top:4px;font-family:var(--mono);">
          Ø³ÙŠÙØ¶Ø§Ù Ø²Ø± ØªØ­Ù…ÙŠÙ„ HTML Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„
        </div>
      </div>

      <!-- Sections toggles -->
      <div class="adv-section">
        <div class="adv-title">Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù‚Ø§Ù„</div>
        <div class="trow">
          <div class="tlbl">â“ Ù‚Ø³Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© (FAQ)</div>
          <button class="toggler on" id="t-faq" onclick="tog('t-faq')"></button>
        </div>
        <div class="trow">
          <div class="tlbl">âš–ï¸ Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ø¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ù†Ø§ÙØ³Ø©</div>
          <button class="toggler on" id="t-cmp" onclick="tog('t-cmp')"></button>
        </div>
        <div class="trow">
          <div class="tlbl">ğŸ”§ Ù‚Ø³Ù… Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</div>
          <button class="toggler" id="t-fix" onclick="tog('t-fix')"></button>
        </div>
        <div class="trow">
          <div class="tlbl">ğŸ¥ Ù‚Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</div>
          <button class="toggler" id="t-vid" onclick="tog('t-vid')"></button>
        </div>
      </div>

    </div><!-- /adv-block -->
  </div>

  <!-- Standard Options -->
  <div class="psec">
    <div class="ph green">Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ø§Ù…Ø©</div>
    <div class="trow">
      <div class="tlbl">ğŸ–¼ï¸ ØµÙˆØ± Unsplash Ø¹Ø§Ø¯ÙŠØ©</div>
      <button class="toggler on" id="t-img" onclick="tog('t-img')"></button>
    </div>
    <div class="trow">
      <div class="tlbl">ğŸ¤– ØµÙˆØ± AI (Pollinations â€” Ù…Ø¬Ø§Ù†ÙŠ)</div>
      <button class="toggler" id="t-aiimg" onclick="tog('t-aiimg')"></button>
    </div>
    <div class="trow">
      <div class="tlbl">ğŸ¯ SEO ØªÙ„Ù‚Ø§Ø¦ÙŠ</div>
      <button class="toggler on" id="t-seo" onclick="tog('t-seo')"></button>
    </div>
    <div class="trow">
      <div class="tlbl">ğŸ• Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù†Ø´Ø±</div>
      <button class="toggler" id="t-sched" onclick="tog('t-sched');toggleSched()"></button>
    </div>
    <div class="schedbox" id="schedbox">
      <div class="flabel" style="margin-bottom:6px;">ğŸ“… Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ø´Ø±</div>
      <input type="datetime-local" id="sched-dt">
    </div>
  </div>

  <!-- Logo Upload -->
  <div class="psec">
    <div class="ph amber">ğŸ·ï¸ Ù„ÙˆØ¬Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
    <div style="font-size:11px;color:var(--text3);margin-bottom:10px;font-family:var(--mono);">
      // ÙŠÙØ¶Ø§Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒØ¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ©
    </div>
    <div class="field">
      <div class="flabel">Ø§Ø±ÙØ¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ (PNG Ø´ÙØ§Ù Ø£Ø­Ø³Ù†)</div>
      <input type="file" id="logo-file" accept="image/*"
        style="background:var(--surf3);border:1px dashed var(--amber);border-radius:8px;
        padding:8px;color:var(--text2);font-size:11px;cursor:pointer;">
    </div>
    <div id="logo-preview" style="display:none;margin-top:8px;text-align:center;">
      <img id="logo-img" style="max-height:50px;border-radius:6px;border:1px solid var(--line2);">
      <div style="font-size:10px;color:var(--green);margin-top:4px;font-family:var(--mono);">âœ… Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø¬Ø§Ù‡Ø²</div>
    </div>
    <div class="field" style="margin-top:10px;">
      <div class="flabel">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ</div>
      <select id="logo-pos">
        <option value="bottom-right">Ø£Ø³ÙÙ„ ÙŠÙ…ÙŠÙ†</option>
        <option value="bottom-left">Ø£Ø³ÙÙ„ ÙŠØ³Ø§Ø±</option>
        <option value="top-right">Ø£Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ†</option>
        <option value="top-left">Ø£Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø±</option>
        <option value="center">Ø§Ù„Ù…Ù†ØªØµÙ</option>
      </select>
    </div>
    <div class="field">
      <div class="flabel">Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ¬Ùˆ: <span id="logo-size-lbl" style="color:var(--amber);font-family:var(--mono);">25%</span></div>
      <input type="range" id="logo-size" min="10" max="50" value="25"
        oninput="document.getElementById('logo-size-lbl').textContent=this.value+'%'">
    </div>
  </div>

</div><!-- /panel -->

<!-- ===== WORKSPACE ===== -->
<div class="workspace">

  <!-- WRITE -->
  <div class="wsec active" id="sec-write">

    <!-- Mode bar -->
    <div class="mode-bar" id="mode-bar">
      <div class="mode-dot std" id="mode-dot"></div>
      <div class="mode-txt" id="mode-txt">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ</div>
      <div class="mode-feat">
        <span class="mfeat c" id="mf-seo" style="display:none">SEO</span>
        <span class="mfeat p" id="mf-adv" style="display:none">AdSense Safe</span>
        <span class="mfeat g" id="mf-img" style="display:none">ØµÙˆØ±</span>
        <span class="mfeat a" id="mf-kw" style="display:none">8 ÙƒÙ„Ù…Ø§Øª</span>
      </div>
    </div>

    <!-- Gen Zone -->
    <div class="genzone">
      <div class="wsh">Ø§Ù„ØªÙˆÙ„ÙŠØ¯</div>
      <button class="genbtn" id="genbtn" onclick="generate()">
        <span>âœ¦</span><span id="gen-lbl">ØªÙˆÙ„ÙŠØ¯ Ù…Ù‚Ø§Ù„ â€” OpenRouter Ù…Ø¬Ø§Ù†ÙŠ</span>
      </button>
      <div class="statsrow" id="statsrow" style="display:none;">
        <div class="sbadge">ğŸ“ <b id="sw">0</b> ÙƒÙ„Ù…Ø©</div>
        <div class="sbadge g">â± <b id="sr">0</b> Ø¯Ù‚</div>
        <div class="sbadge a">ğŸ”¤ <b id="sc">0</b> Ø­Ø±Ù</div>
        <div class="sbadge" id="sb-seo" style="display:none;">ğŸ¯ SEO: <b id="ss">0%</b></div>
        <div class="sbadge" id="sb-adv" style="display:none;background:rgba(179,136,255,.08);border-color:rgba(179,136,255,.2);">
          âš¡ <b style="color:var(--purple);">AdSense âœ“</b>
        </div>
      </div>
    </div>

    <!-- Article Card -->
    <div class="artcard">
      <div class="arthead">
        <div class="arttitle"><span style="width:6px;height:6px;border-radius:50%;background:var(--cyan);display:inline-block;box-shadow:0 0 6px var(--cyan);"></span>Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ù…ÙÙˆÙ„ÙÙ‘Ø¯</div>
        <div class="arttabs">
          <button class="atab on" id="tab-prev" onclick="switchView('preview')">Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
          <button class="atab" id="tab-raw" onclick="switchView('raw')">HTML</button>
          <button class="atab" id="tab-txt" onclick="switchView('txt')">Ù†Øµ</button>
        </div>
      </div>
      <div class="artbody" id="artview">
        <div class="estate">
          <div class="eicon">âœï¸</div>
          <p>Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙˆØ§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯"</p>
          <small style="font-family:var(--mono);">// ÙŠØ¹Ù…Ù„ Ù…Ø¹ OpenRouter â€” Ù…Ø¬Ø§Ù†ÙŠ ÙÙŠ ÙƒÙ„ Ø§Ù„Ø¨Ù„Ø§Ø¯</small>
        </div>
      </div>
    </div>

    <!-- SEO Card -->
    <div class="seocard" id="seocard">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
        <div>
          <div style="font-size:12px;font-weight:600;font-family:var(--mono);margin-bottom:3px;">// SEO_DATA</div>
          <div style="font-size:10px;color:var(--text3);">ØªÙ‡ÙŠØ¦Ø© Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¨Ø­Ø«</div>
        </div>
        <div class="seoring" id="seoring">â€”</div>
      </div>
      <div class="seor"><div class="seok">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</div><div class="seov" id="seo-t">â€”</div></div>
      <div class="seor"><div class="seok">Ø§Ù„ÙˆØµÙ</div><div class="seov" id="seo-d">â€”</div></div>
      <div class="seor"><div class="seok">ÙƒÙ„Ù…Ø§Øª</div><div class="seov" id="seo-k">â€”</div></div>
    </div>

    <!-- Images Card -->
    <div class="imgcard" id="imgcard">
      <div class="wsh">ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ±</div>

      <!-- Tab selector -->
      <div style="display:flex;gap:6px;margin-bottom:14px;">
        <button class="atab on" id="img-tab-unsplash" onclick="switchImgTab('unsplash')">Unsplash</button>
        <button class="atab" id="img-tab-ai" onclick="switchImgTab('ai')">ğŸ¤– AI ØµÙˆØ±</button>
      </div>

      <!-- Unsplash grid -->
      <div id="img-unsplash-sec">
        <div style="font-size:11px;color:var(--text2);margin-bottom:8px;">Ø§Ø®ØªØ± ØµÙˆØ±Ø© â€” Ø³ØªÙØ¶Ø§Ù Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø¹Ù„ÙŠÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>
        <div class="imggrid" id="imggrid"></div>
      </div>

      <!-- AI Image generation -->
      <div id="img-ai-sec" style="display:none;">
        <div style="font-size:11px;color:var(--text2);margin-bottom:10px;">
          Ø¨ÙŠÙˆÙ„Ù‘Ø¯ ØµÙˆØ±ØªÙŠÙ† Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù…Ù‚Ø§Ù„ â€” Ù…Ø¬Ø§Ù†Ø§Ù‹ ğŸ†“
        </div>
        <button class="btng" id="gen-ai-imgs-btn" onclick="generateAIImages()"
          style="width:100%;border-color:var(--purple);color:var(--purple);margin-bottom:12px;justify-content:center;">
          ğŸ¨ ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±ØªÙŠÙ† Ø¨Ø§Ù„Ù€ AI
        </button>
        <div class="imggrid" id="ai-imggrid" style="grid-template-columns:1fr 1fr;">
          <div style="color:var(--text3);font-size:11px;grid-column:1/-1;text-align:center;padding:20px;font-family:var(--mono);">
            // Ø§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯" Ù„Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±ØªÙŠÙ† Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
          </div>
        </div>
      </div>

      <!-- Selected image preview with logo -->
      <div id="img-result-sec" style="display:none;margin-top:14px;">
        <div class="wsh">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© + Ø§Ù„Ù„ÙˆØ¬Ùˆ</div>
        <canvas id="img-canvas" style="width:100%;border-radius:10px;border:1px solid var(--line2);display:block;"></canvas>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
          <button class="btnpub" onclick="downloadWebP()"
            style="background:linear-gradient(135deg,var(--purple),#7c4dff);box-shadow:0 0 18px rgba(179,136,255,.25);">
            â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ WebP
          </button>
          <button class="btng" onclick="downloadPNG()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ PNG</button>
          <button class="btng" onclick="useInArticle()">ğŸ“Œ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ù‚Ø§Ù„</button>
        </div>
        <div style="font-size:10px;color:var(--text3);margin-top:6px;font-family:var(--mono);">
          // Ø§Ù„ØµÙˆØ±Ø© Ù…Ø­Ù…ÙŠØ© Ø¨Ù„ÙˆØ¬Ùˆ Ù…ÙˆÙ‚Ø¹Ùƒ â€” ØºÙŠØ± Ù…Ø³Ø±ÙˆÙ‚Ø© âœ…
        </div>
      </div>

    </div>

    <!-- Actions -->
    <div class="actrow" id="actrow" style="display:none;">
      <button class="btnpub" id="pub-btn" onclick="pubNow()">ğŸš€ Ù†Ø´Ø± Ø¹Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø±</button>
      <button class="btnpub" id="sched-btn" onclick="schedPub()"
        style="background:linear-gradient(135deg,var(--amber),#f4a100);color:var(--ink);box-shadow:0 0 18px rgba(255,215,64,.25);display:none;">
        ğŸ• Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù†Ø´Ø±
      </button>
      <button class="btng" onclick="copyArt()">ğŸ“‹ Ù†Ø³Ø® HTML</button>
      <button class="btng" onclick="dlArt()">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
      <button class="btng" onclick="generate()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©</button>
    </div>

  </div><!-- /write -->

  <!-- HISTORY -->
  <div class="wsec" id="sec-history">
    <div class="wsh">Ø³Ø¬Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</div>
    <div id="hist-render">
      <div style="text-align:center;padding:60px;color:var(--text3);font-family:var(--mono);">// Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø¨Ø¹Ø¯</div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="wsec" id="sec-settings">
    <div class="wsh">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>

    <div class="setcard">
      <div class="sethead" style="background:rgba(16,185,129,.08);"><div class="setdot" style="background:#10b981;"></div>OpenRouter API â€” ğŸ†“ Ù…Ø¬Ø§Ù†ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ø¨Ù„Ø§Ø¯
        <span style="margin-right:auto;background:rgba(0,230,118,.15);color:var(--green);border:1px solid rgba(0,230,118,.3);padding:2px 7px;border-radius:10px;font-size:9px;">âœ… Ø¨Ø¯ÙˆÙ† Ù‚ÙŠÙˆØ¯ Ø¬ØºØ±Ø§ÙÙŠØ©</span>
      </div>
      <div class="setbody">
        <div class="field">
          <div class="flabel">ğŸ”‘ OpenRouter API Key</div>
          <div class="isec"><input type="password" id="cfg-ak" placeholder="sk-or-v1-..."><button class="eye" onclick="toggleEye('cfg-ak',this)">ğŸ‘</button></div>
          <div style="margin-top:8px;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);border-radius:8px;padding:10px 12px;font-size:11px;color:#7ea8d0;font-family:var(--mono);line-height:1.9;">
            âœ… ÙŠØ´ØªØºÙ„ ÙÙŠ Ù…ØµØ± ÙˆÙƒÙ„ Ø§Ù„Ø¨Ù„Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©<br>
            âœ… Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø­Ø¯ ÙŠÙˆÙ…ÙŠ<br>
            âœ… Ø¨Ø¯ÙˆÙ† ÙƒØ±ÙŠØ¯Øª ÙƒØ§Ø±Ø¯ Ù„Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©<br>
            // Ø§Ø­ØµÙ„ Ø¹Ù„ÙŠÙ‡: <a href="https://openrouter.ai/keys" target="_blank" style="color:#10b981;font-weight:600;">openrouter.ai/keys â†—</a>
          </div>
        </div>
        <div class="field" style="margin-top:4px;">
          <div class="flabel">ğŸ¤– Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</div>
          <select id="cfg-model">
            <option value="meta-llama/llama-3.3-70b-instruct:free">â­ Llama 3.3 70B â€” Ù…Ø¬Ø§Ù†ÙŠ Ø§Ù„Ø£ÙØ¶Ù„ Ù„Ù„Ø¹Ø±Ø¨ÙŠ</option>
            <option value="qwen/qwen-2.5-72b-instruct:free">Qwen 2.5 72B â€” Ù…Ø¬Ø§Ù†ÙŠ Ø¹Ø±Ø¨ÙŠ Ù…Ù…ØªØ§Ø²</option>
            <option value="deepseek/deepseek-r1:free">DeepSeek R1 â€” Ù…Ø¬Ø§Ù†ÙŠ Ù‚ÙˆÙŠ Ø¬Ø¯Ø§Ù‹</option>
            <option value="google/gemma-3-27b-it:free">Gemma 3 27B â€” Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù† Google</option>
            <option value="mistralai/mistral-7b-instruct:free">Mistral 7B â€” Ù…Ø¬Ø§Ù†ÙŠ Ø³Ø±ÙŠØ¹</option>
          </select>
          <div style="font-size:10px;color:var(--text3);margin-top:4px;font-family:var(--mono);">// ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© â€” Ø§Ù„Ø£Ø­Ø³Ù†: Llama Ø£Ùˆ Qwen</div>
        </div>
      </div>
    </div>

    <div class="setcard">
      <div class="sethead"><div class="setdot" style="background:var(--green);"></div>Blogger API</div>
      <div class="setbody">
        <div class="field">
          <div class="flabel">ğŸ“° Blog ID</div>
          <input type="text" id="cfg-bid" placeholder="12345678901234567">
          <div style="font-size:10px;color:var(--text3);margin-top:4px;font-family:var(--mono);">// Ù…Ù† Ø±Ø§Ø¨Ø· Ø¨Ù„ÙˆØ¬Ø±: blogger.com/blog/posts/<b style="color:var(--cyan);">BLOG_ID</b></div>
        </div>
        <div class="field">
          <div class="flabel">ğŸ” Access Token</div>
          <div class="isec"><input type="password" id="cfg-tok" placeholder="ya29.xxxxxxxx"><button class="eye" onclick="toggleEye('cfg-tok',this)">ğŸ‘</button></div>
          <div style="font-size:10px;color:var(--text3);margin-top:4px;font-family:var(--mono);">
            // Ù…Ù†: <a href="https://developers.google.com/oauthplayground" target="_blank" style="color:var(--cyan);">OAuth Playground â†—</a><br>
            âš ï¸ ÙŠÙ†ØªÙ‡ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø© â€” Ø¬Ø¯Ù‘Ø¯Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
          </div>
        </div>
      </div>
    </div>

    <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;">
      <button class="btnpub" onclick="saveCfg()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      <button class="btng" id="verify-btn" onclick="verifyAll()" style="border-color:var(--amber);color:var(--amber);">
        ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙØ§ØªÙŠØ­
      </button>
    </div>

    <!-- VERIFICATION RESULTS CARD -->
    <div class="setcard" id="verify-card" style="display:none;border-color:rgba(255,215,64,.2);">
      <div class="sethead" style="background:rgba(255,215,64,.06);">
        <div class="setdot" style="background:var(--amber);"></div>
        Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚
        <span id="verify-overall" style="margin-right:auto;padding:2px 10px;border-radius:10px;font-size:10px;font-family:var(--mono);"></span>
      </div>
      <div class="setbody" style="display:flex;flex-direction:column;gap:10px;">

        <!-- OpenRouter Check -->
        <div class="vrow" id="v-api">
          <div class="vicon" id="vi-api">â³</div>
          <div class="vinfo">
            <div class="vtitle">OpenRouter API Key</div>
            <div class="vdetail" id="vd-api">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>
          </div>
          <div class="vstatus" id="vs-api">â€”</div>
        </div>

        <!-- Blog ID Check -->
        <div class="vrow" id="v-bid">
          <div class="vicon" id="vi-bid">â³</div>
          <div class="vinfo">
            <div class="vtitle">Blog ID</div>
            <div class="vdetail" id="vd-bid">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>
          </div>
          <div class="vstatus" id="vs-bid">â€”</div>
        </div>

        <!-- Access Token Check -->
        <div class="vrow" id="v-tok">
          <div class="vicon" id="vi-tok">â³</div>
          <div class="vinfo">
            <div class="vtitle">Access Token (Blogger)</div>
            <div class="vdetail" id="vd-tok">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>
          </div>
          <div class="vstatus" id="vs-tok">â€”</div>
        </div>

        <!-- Summary -->
        <div id="verify-summary" style="display:none;background:var(--ink2);border-radius:8px;padding:12px;font-size:12px;font-family:var(--mono);color:var(--text2);line-height:1.9;margin-top:4px;border:1px solid var(--line2);"></div>

      </div>
    </div>

    <div class="setcard">
      <div class="sethead"><div class="setdot" style="background:var(--purple);"></div>Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</div>
      <div class="setbody">
        <div class="tip-box">
          âš¡ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙŠÙÙˆÙ„Ù‘Ø¯ Ù…Ù‚Ø§Ù„Ø§Ù‹:<br>
          âœ“ Ø¢Ù…Ù† Ù„Ø³ÙŠØ§Ø³Ø© Google AdSense<br>
          âœ“ 8 ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ù…ÙˆØ²Ù‘Ø¹Ø© Ø°ÙƒÙŠØ§Ù‹<br>
          âœ“ H2 Ø£Ø­Ù…Ø± + H3 Ø£Ø²Ø±Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹<br>
          âœ“ Ø²Ø± ØªØ­Ù…ÙŠÙ„ HTML Ø¬Ø§Ù‡Ø²<br>
          âœ“ Ù…Ù‚Ø§Ø±Ù†Ø© + FAQ + Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„<br>
          âœ“ Ù…Ù‚Ø§Ù„Ø§Øª Ù…Ù‚ØªØ±Ø­Ø© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©<br>
          âœ“ Ø£Ø³Ù„ÙˆØ¨ Ø¨Ø´Ø±ÙŠ ØºÙŠØ± Ù…ÙƒØªØ´Ù
        </div>
      </div>
    </div>
  </div>

  <!-- GUIDE -->
  <div class="wsec" id="sec-guide">
    <div class="wsh">ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØ§ØªÙŠØ­</div>

    <!-- OPENROUTER -->
    <div class="setcard" style="border-color:rgba(16,185,129,.3);">
      <div class="sethead" style="background:rgba(16,185,129,.08);">
        <div class="setdot" style="background:#10b981;"></div>
        ğŸ”‘ OpenRouter API Key â€” Ù…Ø¬Ø§Ù†ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ø¨Ù„Ø§Ø¯ âœ…
        <span style="margin-right:auto;background:rgba(0,230,118,.15);color:var(--green);border:1px solid rgba(0,230,118,.3);padding:2px 8px;border-radius:10px;font-size:9px;">âœ… Ø¨ÙŠØ´ØªØºÙ„ ÙÙŠ Ù…ØµØ±</span>
      </div>
      <div class="setbody">
        <div style="display:flex;flex-direction:column;gap:10px;">
          <div class="guide-step">
            <div class="gs-num">1</div>
            <div class="gs-txt">Ø±ÙˆØ­ Ø¹Ù„Ù‰: <a href="https://openrouter.ai" target="_blank" style="color:#10b981;font-weight:600;">openrouter.ai â†—</a></div>
          </div>
          <div class="guide-step">
            <div class="gs-num">2</div>
            <div class="gs-txt">Ø§Ø¶ØºØ· <b style="color:#10b981;">"Sign in"</b> â† Ø³Ø¬Ù‘Ù„ Ø¨Ù€ Google Ø£Ùˆ GitHub Ø£Ùˆ Ø¥ÙŠÙ…ÙŠÙ„ Ø¹Ø§Ø¯ÙŠ</div>
          </div>
          <div class="guide-step">
            <div class="gs-num">3</div>
            <div class="gs-txt">Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø±ÙˆØ­ Ø¹Ù„Ù‰: <a href="https://openrouter.ai/keys" target="_blank" style="color:#10b981;">openrouter.ai/keys â†—</a></div>
          </div>
          <div class="guide-step">
            <div class="gs-num">4</div>
            <div class="gs-txt">Ø§Ø¶ØºØ· <b style="color:#10b981;">"Create Key"</b> â† Ø§ÙƒØªØ¨ Ø£ÙŠ Ø§Ø³Ù… Ù…Ø«Ù„Ø§Ù‹ <code style="background:var(--ink2);padding:1px 5px;border-radius:3px;">blogmind</code> â† Ø§Ø¶ØºØ· <b>"Create"</b></div>
          </div>
          <div class="guide-step">
            <div class="gs-num">5</div>
            <div class="gs-txt">Ø§Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙˆØ±Ø§Ù‹ â€” <b style="color:var(--rose);">Ù…Ø´ Ù‡ÙŠØªØ¹Ø±Ø¶ ØªØ§Ù†ÙŠ!</b></div>
          </div>
          <div class="guide-step">
            <div class="gs-num">6</div>
            <div class="gs-txt">Ø±ÙˆØ­ <b>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</b> ÙˆØ­Ø·Ù‡ ÙÙŠ Ø®Ø§Ù†Ø© OpenRouter API Key â† Ø§Ø¶ØºØ· <b>ğŸ’¾ Ø­ÙØ¸</b></div>
          </div>
          <div style="background:rgba(16,185,129,.07);border:1px solid rgba(16,185,129,.2);border-radius:8px;padding:10px 12px;font-size:11px;color:var(--text2);font-family:var(--mono);">
            Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨ÙŠØ¨Ø¯Ø£ Ø¨Ù€: <span style="color:#10b981;">sk-or-v1-...</span><br>
            âœ… Ù…Ø¬Ø§Ù†ÙŠ â€” Ù„Ø§ ÙŠØ­ØªØ§Ø¬ ÙƒØ±ÙŠØ¯Øª ÙƒØ§Ø±Ø¯<br>
            âœ… ÙŠØ´ØªØºÙ„ ÙÙŠ Ù…ØµØ± ÙˆÙƒÙ„ Ø§Ù„Ø¨Ù„Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©<br>
            âœ… Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±
          </div>
        </div>
      </div>
    </div>

    <!-- BLOG ID -->
    <div class="setcard" style="border-color:rgba(0,230,118,.2);">
      <div class="sethead" style="background:rgba(0,230,118,.05);">
        <div class="setdot" style="background:var(--green);"></div>
        ğŸ“° Blog ID â€” Ø«Ø§Ø¨Øª Ù…Ø´ Ø¨ÙŠØªØºÙŠØ±
      </div>
      <div class="setbody">
        <div style="display:flex;flex-direction:column;gap:10px;">
          <div class="guide-step">
            <div class="gs-num">1</div>
            <div class="gs-txt">Ø±ÙˆØ­ Ø¹Ù„Ù‰ <a href="https://blogger.com" target="_blank" style="color:var(--green);">blogger.com â†—</a> ÙˆØ§Ø¯Ø®Ù„ Ø¹Ù„Ù‰ Ù…Ø¯ÙˆÙ†ØªÙƒ</div>
          </div>
          <div class="guide-step">
            <div class="gs-num">2</div>
            <div class="gs-txt">Ø¨Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ â€” Ù‡ØªÙ„Ø§Ù‚ÙŠ Ø£Ø±Ù‚Ø§Ù… ÙƒØ¨ÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·</div>
          </div>
          <div style="background:var(--ink2);border:1px solid var(--line2);border-radius:8px;padding:10px 12px;font-size:11px;font-family:var(--mono);color:var(--text2);word-break:break-all;">
            blogger.com/blog/posts/<span style="color:var(--green);font-weight:700;background:rgba(0,230,118,.1);padding:1px 4px;border-radius:3px;">1234567890123456789</span>
          </div>
          <div class="guide-step">
            <div class="gs-num">3</div>
            <div class="gs-txt">Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¯ÙŠ Ù‡ÙŠ Ø§Ù„Ù€ Blog ID â€” Ø§Ù†Ø³Ø®Ù‡Ø§ ÙˆØ­Ø·Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
          </div>
          <div class="guide-step">
            <div class="gs-num" style="background:rgba(0,230,118,.2);color:var(--green);">ğŸ’¡</div>
            <div class="gs-txt"><b>Ø·Ø±ÙŠÙ‚Ø© ØªØ§Ù†ÙŠØ©:</b> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¯ÙˆÙ†Ø© â† Ø³ØªÙ„Ø§Ù‚ÙŠ Ø§Ù„Ù€ ID</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ACCESS TOKEN -->
    <div class="setcard" style="border-color:rgba(255,215,64,.2);">
      <div class="sethead" style="background:rgba(255,215,64,.05);">
        <div class="setdot" style="background:var(--amber);"></div>
        ğŸ” Access Token â€” Ø¨ÙŠØªØ¬Ø¯Ø¯ ÙƒÙ„ Ø³Ø§Ø¹Ø©
        <span style="margin-right:auto;background:rgba(255,215,64,.15);color:var(--amber);border:1px solid rgba(255,215,64,.3);padding:2px 8px;border-radius:10px;font-size:9px;">âš ï¸ ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø©</span>
      </div>
      <div class="setbody">
        <div style="display:flex;flex-direction:column;gap:10px;">
          <div class="guide-step">
            <div class="gs-num">1</div>
            <div class="gs-txt">Ø±ÙˆØ­ Ø¹Ù„Ù‰: <a href="https://developers.google.com/oauthplayground" target="_blank" style="color:var(--amber);">developers.google.com/oauthplayground â†—</a></div>
          </div>
          <div class="guide-step">
            <div class="gs-num">2</div>
            <div class="gs-txt">ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± â€” Ø§Ø¨Ø­Ø« Ø¹Ù† <b>"Blogger API v3"</b> Ø£Ùˆ Ø§Ø¯ÙˆÙ‘Ø± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù†Ø³Ø®Ù‡ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:</div>
          </div>
          <div style="background:var(--ink2);border:1px solid var(--line2);border-radius:8px;padding:10px 12px;font-size:11px;font-family:var(--mono);color:var(--cyan);word-break:break-all;">
            https://www.googleapis.com/auth/blogger
          </div>
          <div class="guide-step">
            <div class="gs-num">3</div>
            <div class="gs-txt">Ø§Ø®ØªØ±Ù‡ Ù…Ù† Ø§Ù„Ù‚Ø§ÙŠÙ…Ø© â† Ø§Ø¶ØºØ· <b style="color:var(--amber);">"Authorize APIs"</b></div>
          </div>
          <div class="guide-step">
            <div class="gs-num">4</div>
            <div class="gs-txt">Ù‡ÙŠÙØªØ­ Ù†Ø§ÙØ°Ø© Google â€” Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ù†ÙØ³ Ø£ÙƒØ§ÙˆÙ†Øª Ø¨Ù„ÙˆØ¬Ø± â† Ø§Ø¶ØºØ· <b>"Allow"</b></div>
          </div>
          <div class="guide-step">
            <div class="gs-num">5</div>
            <div class="gs-txt">Ù‡ØªØ±Ø¬Ø¹ Ù„Ù„ØµÙØ­Ø© â€” Ø§Ø¶ØºØ· <b style="color:var(--amber);">"Exchange authorization code for tokens"</b></div>
          </div>
          <div class="guide-step">
            <div class="gs-num">6</div>
            <div class="gs-txt">Ø§Ù†Ø³Ø® Ø§Ù„Ù€ <b>Access Token</b> Ù…Ù† Ø®Ø§Ù†Ø© "Access token" ÙˆØ­Ø·Ù‡ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
          </div>
          <div style="background:rgba(255,215,64,.07);border:1px solid rgba(255,215,64,.2);border-radius:8px;padding:10px 12px;font-size:11px;color:var(--text2);font-family:var(--mono);">
            Ø§Ù„ØªÙˆÙƒÙ† Ø¨ÙŠØ¨Ø¯Ø£ Ø¨Ù€: <span style="color:var(--amber);">ya29.xxxxxx</span><br>
            âš ï¸ Ø¨ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø© â€” ÙƒØ±Ø± Ø§Ù„Ø®Ø·ÙˆØ§Øª Ù„Ùˆ Ø¸Ù‡Ø±Øª Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ 401
          </div>
        </div>
      </div>
    </div>

    <!-- SUMMARY TABLE -->
    <div class="setcard">
      <div class="sethead"><div class="setdot" style="background:var(--cyan);"></div>Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹</div>
      <div class="setbody">
        <table style="width:100%;border-collapse:collapse;font-size:12px;">
          <tr style="border-bottom:1px solid var(--line2);">
            <td style="padding:8px;color:var(--text2);font-family:var(--mono);">Ø§Ù„Ù…ÙØªØ§Ø­</td>
            <td style="padding:8px;color:var(--text2);font-family:var(--mono);">Ø§Ù„Ù…ØµØ¯Ø±</td>
            <td style="padding:8px;color:var(--text2);font-family:var(--mono);">Ù…Ø¯Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</td>
          </tr>
          <tr style="border-bottom:1px solid var(--line);">
            <td style="padding:8px;color:#10b981;">OpenRouter Key</td>
            <td style="padding:8px;color:var(--text);">openrouter.ai/keys</td>
            <td style="padding:8px;color:var(--green);">Ø¯Ø§Ø¦Ù… âœ…</td>
          </tr>
          <tr style="border-bottom:1px solid var(--line);">
            <td style="padding:8px;color:var(--green);">Blog ID</td>
            <td style="padding:8px;color:var(--text);">Ø±Ø§Ø¨Ø· Ø¨Ù„ÙˆØ¬Ø±</td>
            <td style="padding:8px;color:var(--green);">Ø¯Ø§Ø¦Ù… âœ…</td>
          </tr>
          <tr>
            <td style="padding:8px;color:var(--amber);">Access Token</td>
            <td style="padding:8px;color:var(--text);">OAuth Playground</td>
            <td style="padding:8px;color:var(--amber);">âš ï¸ Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©</td>
          </tr>
        </table>
      </div>
    </div>

    <div style="text-align:center;margin-top:8px;">
      <button class="btnpub" onclick="showSec('settings', document.querySelectorAll('.npill')[3])">
        âš™ï¸ Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØ§ØªÙŠØ­
      </button>
    </div>
  </div>

</div><!-- /workspace -->
</div><!-- /app -->

<!-- MODAL -->
<div class="moverlay" id="modal">
  <div class="modal">
    <h3 id="m-title">ØªØ£ÙƒÙŠØ¯</h3>
    <p id="m-body">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</p>
    <div class="mbtns">
      <button class="btnpub" id="m-ok">ØªØ£ÙƒÙŠØ¯</button>
      <button class="btng" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ============================
   STATE
============================= */
let selectedLang = 'ar';
let selectedTone = 'Ø¨Ø³ÙŠØ· ÙˆØ·Ø¨ÙŠØ¹ÙŠ';
let advMode = false;
let currentArticle = null;
let currentSEO = null;
let selectedImg = null;
let viewMode = 'preview';
let history = JSON.parse(localStorage.getItem('bm_hist') || '[]');
let modalCb = null;

const lenMap = {1:'800 ÙƒÙ„Ù…Ø©', 2:'1200 ÙƒÙ„Ù…Ø©', 3:'1800+ ÙƒÙ„Ù…Ø©'};
const lenWords = {1:800, 2:1200, 3:1800};

/* ============================
   INIT
============================= */
window.onload = () => {
  loadCfg();
  renderHistory();
  buildKwGrid();
};

/* ============================
   KEYWORD GRID
============================= */
function buildKwGrid() {
  const g = document.getElementById('kw-grid');
  g.innerHTML = Array.from({length:8}, (_,i) => `
    <div class="kw-input-wrap">
      <div class="kw-num">K${i+1}</div>
      <input type="text" id="kw${i+1}" placeholder="ÙƒÙ„Ù…Ø© ${i+1}">
    </div>
  `).join('');
}

function getKeywords() {
  return Array.from({length:8}, (_,i) => {
    const v = document.getElementById('kw'+(i+1));
    return v ? v.value.trim() : '';
  }).filter(Boolean);
}

/* ============================
   ADVANCED MODE
============================= */
function toggleAdv() {
  advMode = !advMode;
  const tog = document.getElementById('t-adv');
  const badge = document.getElementById('adv-badge');
  const block = document.getElementById('adv-block');
  const mdot = document.getElementById('mode-dot');
  const mtxt = document.getElementById('mode-txt');
  const gbtn = document.getElementById('genbtn');

  tog.classList.toggle('on', advMode);
  block.classList.toggle('shown', advMode);
  badge.textContent = advMode ? 'âš¡ ØªØ´ØºÙŠÙ„' : 'ğŸ”’ Ø¥ÙŠÙ‚Ø§Ù';
  badge.classList.toggle('adv-on', advMode);
  mdot.className = 'mode-dot ' + (advMode ? 'adv' : 'std');
  mtxt.textContent = advMode ? 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… â€” AdSense Safe' : 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ';
  gbtn.classList.toggle('adv-mode', advMode);

  document.getElementById('mf-adv').style.display = advMode ? 'inline-flex' : 'none';
  document.getElementById('mf-kw').style.display = advMode ? 'inline-flex' : 'none';
}

/* ============================
   SECTION NAV
============================= */
function showSec(sec, btn) {
  document.querySelectorAll('.wsec').forEach(s=>s.classList.remove('active'));
  document.getElementById('sec-'+sec).classList.add('active');
  document.querySelectorAll('.npill').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
  if(sec==='history') renderHistory();
}

/* ============================
   TOGGLES / MISC
============================= */
function tog(id){ document.getElementById(id).classList.toggle('on'); }
function isOn(id){ return document.getElementById(id).classList.contains('on'); }
function setLang(l,btn){ document.querySelectorAll('.lbtn').forEach(b=>b.classList.remove('on')); btn.classList.add('on'); selectedLang=l; }
function setTone(t,btn){ document.querySelectorAll('.tbtn').forEach(b=>b.classList.remove('on')); btn.classList.add('on'); selectedTone=t; }
function onLen(v){ document.getElementById('len-lbl').textContent = lenMap[v]; }
function toggleSched(){
  const on = isOn('t-sched');
  document.getElementById('schedbox').classList.toggle('shown', on);
  document.getElementById('sched-btn').style.display = on ? 'flex' : 'none';
}
function toggleEye(id,btn){
  const el=document.getElementById(id);
  el.type=el.type==='password'?'text':'password';
  btn.textContent=el.type==='password'?'ğŸ‘':'ğŸ™ˆ';
}

/* ============================
   CONFIG
============================= */
function saveCfg(){
  localStorage.setItem('bm_cfg', JSON.stringify({
    ak: document.getElementById('cfg-ak').value,
    bid: document.getElementById('cfg-bid').value,
    tok: document.getElementById('cfg-tok').value,
    model: document.getElementById('cfg-model').value
  }));
  toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
}
function loadCfg(){
  const c = JSON.parse(localStorage.getItem('bm_cfg')||'{}');
  if(c.ak) document.getElementById('cfg-ak').value=c.ak;
  if(c.bid) document.getElementById('cfg-bid').value=c.bid;
  if(c.tok) document.getElementById('cfg-tok').value=c.tok;
  if(c.model) document.getElementById('cfg-model').value=c.model;
}
function getCfg(){ return JSON.parse(localStorage.getItem('bm_cfg')||'{}'); }

/* ============================
   GENERATE
============================= */
async function generate(){
  const cfg = getCfg();
  const topic = document.getElementById('topic').value.trim();
  if(!cfg.ak){ toast('âŒ Ø£Ø¯Ø®Ù„ OpenRouter API Key ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', true); return; }
  if(!topic){ toast('âŒ Ø£Ø¯Ø®Ù„ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù…Ù‚Ø§Ù„', true); return; }

  const btn = document.getElementById('genbtn');
  const lbl = document.getElementById('gen-lbl');
  btn.disabled=true;
  lbl.textContent = advMode ? 'âš¡ ØªÙˆÙ„ÙŠØ¯ Ù…Ù‚Ø§Ù„ AdSense Ù…ØªÙ‚Ø¯Ù…...' : 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...';

  document.getElementById('actrow').style.display='none';
  document.getElementById('seocard').classList.remove('shown');
  document.getElementById('imgcard').classList.remove('shown');
  document.getElementById('statsrow').style.display='none';

  showLoader(advMode);

  const prompt = advMode ? buildAdvancedPrompt(topic) : buildStandardPrompt(topic);

  try {
    // ===== OpenRouter API â€” Smart Fallback System =====
    // Ù„Ùˆ Ù…ÙˆØ¯ÙŠÙ„ Ø§ØªØ¹Ø·Ù„ Ø£Ùˆ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ØŒ ÙŠØ¬Ø±Ø¨ Ø§Ù„ØªØ§Ù†ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    const MODELS = [
      { id: cfg.model || 'meta-llama/llama-3.3-70b-instruct:free', name: 'Llama 3.3' },
      { id: 'qwen/qwen-2.5-72b-instruct:free',                     name: 'Qwen 2.5'  },
      { id: 'deepseek/deepseek-r1:free',                           name: 'DeepSeek R1'},
      { id: 'google/gemma-3-27b-it:free',                          name: 'Gemma 3'   },
      { id: 'mistralai/mistral-7b-instruct:free',                  name: 'Mistral 7B' },
    ];
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„Ùˆ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø± Ù‡Ùˆ Ù†ÙØ³ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ù‚Ø§ÙŠÙ…Ø©
    const uniqueModels = [
      MODELS[0],
      ...MODELS.slice(1).filter(m => m.id !== MODELS[0].id)
    ];

    let data = null;
    let usedModel = '';
    let lastError = '';

    for (let i = 0; i < uniqueModels.length; i++) {
      const m = uniqueModels[i];
      // ØªØ­Ø¯ÙŠØ« loader Ø¨Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ
      const lmsg = document.querySelector('.lmsg');
      if(lmsg) lmsg.textContent = `// Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ù…Ø¹ ${m.name}... (${i+1}/${uniqueModels.length})`;

      try {
        const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${cfg.ak}`,
            'HTTP-Referer': window.location.href,
            'X-Title': 'BlogMind AI'
          },
          body: JSON.stringify({
            model: m.id,
            messages: [{ role: 'user', content: prompt }],
            temperature: 0.85,
            max_tokens: 8000
          })
        });

        if (res.status === 401) {
          throw new Error('__FATAL__:API Key Ø®Ø§Ø·Ø¦ â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
        }

        if (res.ok) {
          const d = await res.json();
          if (d.choices?.[0]?.message?.content) {
            data = d;
            usedModel = m.name;
            break; // Ù†Ø¬Ø­ â€” Ø§Ø®Ø±Ø¬ Ù…Ù† Ø§Ù„Ù„ÙˆØ¨
          }
        }
        // 429 Ø£Ùˆ 402 Ø£Ùˆ ØºÙŠØ±Ù‡Ø§ â€” Ø¬Ø±Ø¨ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„ØªØ§Ù†ÙŠ
        lastError = `${m.name}: HTTP ${res.status}`;
      } catch(innerErr) {
        if(innerErr.message.startsWith('__FATAL__:')) throw new Error(innerErr.message.replace('__FATAL__:',''));
        lastError = innerErr.message;
      }
    }

    if (!data) {
      throw new Error(`ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø¯Ù„ÙˆÙ‚ØªÙŠ â€” Ø­Ø§ÙˆÙ„ Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø©\n(${lastError})`);
    }

    toast(`âœ… ÙƒÙØªØ¨ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨ÙˆØ§Ø³Ø·Ø© ${usedModel}`, false);

    let raw = data.choices[0].message.content;

    // ØªÙ†Ø¸ÙŠÙ markdown code blocks
    raw = raw.replace(/^```html\n?/i,'').replace(/^```\n?/,'').replace(/\n?```$/,'').trim();

    let artText = raw;

    // Extract SEO block
    if(isOn('t-seo') && raw.includes('===SEO===')) {
      const parts = raw.split('===SEO===');
      artText = parts[0].trim();
      try {
        currentSEO = JSON.parse(parts[1].split('===END===')[0].trim());
        renderSEO(currentSEO);
      } catch(e){}
    }

    currentArticle = artText;
    viewMode='preview';
    document.getElementById('tab-prev').classList.add('on');
    document.getElementById('tab-raw').classList.remove('on');
    document.getElementById('tab-txt').classList.remove('on');
    
    // ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ± AI ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ø¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ
    if(isOn('t-aiimg')){
      document.getElementById('imgcard').classList.add('shown');
      await autoGenerateImagesWithLogo(topic);
    } else if(isOn('t-img')){
      document.getElementById('imgcard').classList.add('shown'); 
      loadImages(topic);
    }
    
    renderArticle(artText);
    updateStats(artText);

    document.getElementById('statsrow').style.display='flex';
    document.getElementById('actrow').style.display='flex';
    document.getElementById('sb-adv').style.display = advMode ? 'flex' : 'none';

    // SEO mode features
    document.getElementById('mf-seo').style.display = isOn('t-seo') ? 'inline-flex' : 'none';
    document.getElementById('mf-img').style.display = (isOn('t-img')||isOn('t-aiimg')) ? 'inline-flex' : 'none';

    toast(advMode ? 'âš¡ ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù…Ù‚Ø§Ù„ AdSense Ø§Ø­ØªØ±Ø§ÙÙŠ!' : 'âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ù„!');

  } catch(err) {
    document.getElementById('artview').innerHTML=`
      <div class="estate"><div style="font-size:32px">âš ï¸</div>
      <p style="color:var(--rose)">${err.message}</p>
      <small>// ØªØ­Ù‚Ù‚ Ù…Ù† API Key ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</small></div>`;
    toast('âŒ '+err.message, true);
  } finally {
    btn.disabled=false;
    lbl.textContent = advMode ? 'ØªÙˆÙ„ÙŠØ¯ Ù…Ù‚Ø§Ù„ AdSense Ù…ØªÙ‚Ø¯Ù…' : 'ØªÙˆÙ„ÙŠØ¯ Ù…Ù‚Ø§Ù„ â€” OpenRouter Ù…Ø¬Ø§Ù†ÙŠ';
  }
}

/* ============================
   PROMPTS
============================= */
function buildStandardPrompt(topic){
  const wc = lenWords[document.getElementById('len-sl').value];
  const langStr = {ar:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', en:'English', bi:'Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ù…ØµØ·Ù„Ø­Ø§Øª Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©'}[selectedLang];
  const seoReq = isOn('t-seo') ? `\n\nØ¨Ø¹Ø¯ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø£Ø¶Ù:\n===SEO===\n{"title":"Ø¹Ù†ÙˆØ§Ù† SEO 60 Ø­Ø±Ù","description":"ÙˆØµÙ 155 Ø­Ø±Ù","score":85}\n===END===` : '';
  return `Ø£Ù†Øª ÙƒØ§ØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø±Ù‚Ù…ÙŠ Ù…Ø­ØªØ±Ù. Ø§ÙƒØªØ¨ Ù…Ù‚Ø§Ù„Ø§Ù‹ Ø¨Ø§Ù„Ù„ØºØ© ${langStr} Ø¨Ø£Ø³Ù„ÙˆØ¨ ${selectedTone}.
Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${topic}
Ø§Ù„Ø·ÙˆÙ„: ~${wc} ÙƒÙ„Ù…Ø©
Ø§Ù„ØªØµÙ†ÙŠÙ: ${document.getElementById('cat').value || 'Ø¹Ø§Ù…'}

Ø§ÙƒØªØ¨ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØ§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¹ Ø¹Ù†Ø§ÙˆÙŠÙ† ÙØ±Ø¹ÙŠØ© H2 ÙˆH3 Ù…Ù†Ø¸Ù…Ø©. Ø§Ø¨Ø¯Ø£ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† H1.${seoReq}`;
}

function buildAdvancedPrompt(topic){
  const kws = getKeywords();
  const wc = lenWords[document.getElementById('len-sl').value];
  const dlLink = document.getElementById('dl-link').value.trim() || '#';
  const rel1 = document.getElementById('rel1').value.trim();
  const rel2 = document.getElementById('rel2').value.trim();
  const blogname = document.getElementById('blogname').value.trim() || 'Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©';
  const cat = document.getElementById('cat').value.trim() || 'Ø¹Ø§Ù…';
  const targetCat = document.getElementById('target-cat').value;
  const langStr = {ar:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ø§Ù„Ù…Ø¨Ø³Ø·Ø©', en:'English (Professional)', bi:'Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ù…ØµØ·Ù„Ø­Ø§Øª Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù…ØªØ®ØµØµØ©'}[selectedLang];

  const kwSection = kws.length > 0 ? `
ğŸ“Œ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© ÙˆØªÙˆØ²ÙŠØ¹Ù‡Ø§ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠ:
${kws.map((k,i)=>`${i+1}. "${k}"`).join('\n')}

ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©:
- Ø§Ù„ÙƒÙ„Ù…Ø© (1) "${kws[0]||''}" â†’ Ø¯Ø§Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† H1 Ø­Ø±ÙÙŠØ§Ù‹
- Ø§Ù„ÙƒÙ„Ù…Ø§Øª (2)-(3) â†’ Ø¯Ø§Ø®Ù„ Ø¹Ù†Ø§ÙˆÙŠÙ† H2 Ø­Ø±ÙÙŠØ§Ù‹
- Ø§Ù„ÙƒÙ„Ù…Ø§Øª (4)-(5) â†’ Ø¯Ø§Ø®Ù„ Ø¹Ù†Ø§ÙˆÙŠÙ† H3 Ø£Ùˆ Ø£ÙˆÙ„ Ø¬Ù…Ù„Ø© ÙÙ‚Ø±Ø©
- Ø§Ù„ÙƒÙ„Ù…Ø§Øª (6)-(8) â†’ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙÙ‚Ø±Ø§Øª Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ` : '';

  const faqSection = isOn('t-faq') ? `
- âœ… Ø£Ø¶Ù Ù‚Ø³Ù… H2 Ø¨Ø¹Ù†ÙˆØ§Ù† "Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ø¦Ø¹Ø© Ø­ÙˆÙ„ ${topic}" ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 3-4 Ø£Ø³Ø¦Ù„Ø© ÙˆØ£Ø¬ÙˆØ¨Ø© Ø¨ØµÙŠØºØ© Ø¨Ø´Ø±ÙŠØ© Ø·Ø¨ÙŠØ¹ÙŠØ©` : '';

  const cmpSection = isOn('t-cmp') ? `
- âœ… Ø£Ø¶Ù Ù‚Ø³Ù… H2 Ø¨Ø¹Ù†ÙˆØ§Ù†: "Ù…Ù‚Ø§Ø±Ù†Ø© ${topic} Ù…Ø¹ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø£Ø®Ø±Ù‰ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ø§Ù„" â€” Ù…Ù‚Ø§Ø±Ù†Ø© Ø­ÙŠØ§Ø¯ÙŠØ© ÙˆÙ…ÙˆØ¶ÙˆØ¹ÙŠØ© Ø¨Ø¯ÙˆÙ† Ù…Ø¨Ø§Ù„ØºØ© Ø£Ùˆ ØªØ­Ù‚ÙŠØ± Ù„Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ†` : '';

  const fixSection = isOn('t-fix') ? `
- âœ… Ø£Ø¶Ù Ù‚Ø³Ù… H2 Ø¨Ø¹Ù†ÙˆØ§Ù† "Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ ${topic} Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©" â€” ÙÙ‚Ø· Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯Øª Ù…Ø´Ø§ÙƒÙ„ ÙˆØ­Ù„ÙˆÙ„ Ø­Ù‚ÙŠÙ‚ÙŠØ©` : '';

  const vidSection = isOn('t-vid') ? `
- âœ… Ø£Ø¶Ù Ø¹Ù†ÙˆØ§Ù† H2 Ù…Ø®ØµØµ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ + Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ØªÙˆØ¶Ø­ Ø£Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ´Ø±Ø­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù…Ù„ÙŠØ§Ù‹` : '';

  const relSection = (rel1||rel2) ? `
- âœ… ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù‚Ø§Ù„ Ø£Ø¶Ù Ù‚Ø³Ù… H2 Ø¨Ø§Ù„Ù†Øµ Ø§Ù„ØªØ§Ù„ÙŠ Ø­Ø±ÙÙŠØ§Ù‹:
  "Ù…Ù‚Ø§Ù„Ø§Øª Ù…Ø®ØªØ§Ø±Ø© Ù…Ù† ${blogname} Ù‚Ø¯ ØªÙ‡Ù…Ù‘Ùƒ Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ø§Ù„:"
  Ø«Ù… Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø·ÙŠØ© Ø¨Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø±ÙˆØ§Ø¨Ø·:
  ${rel1 ? `â€¢ ${rel1}` : ''}
  ${rel2 ? `â€¢ ${rel2}` : ''}` : '';

  const seoReq = isOn('t-seo') ? `

Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ù„ HTML ÙƒØ§Ù…Ù„Ø§Ù‹ØŒ Ø£Ø¶Ù:
===SEO===
{"title":"${kws[0]||topic} â€” Ø¹Ù†ÙˆØ§Ù† SEO Ø¯Ù‚ÙŠÙ‚ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 60 Ø­Ø±ÙØ§Ù‹","description":"ÙˆØµÙ meta Ø¬Ø°Ø§Ø¨ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 155 Ø­Ø±ÙØ§Ù‹","score":88}
===END===` : '';

  return `Ø£Ù†Øª ÙƒØ§ØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø±Ù‚Ù…ÙŠ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ø¢Ù…Ù† Ù„Ù€ Google AdSense.

Ø§ÙƒØªØ¨ Ù…Ù‚Ø§Ù„Ø§Ù‹ Ø¨Ù€ HTML ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¨Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:

ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù„:
- Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${topic}
- Ø§Ù„Ù„ØºØ©: ${langStr}
- Ø§Ù„Ù†Ø¨Ø±Ø©: ${selectedTone}
- Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©: ${targetCat}
- Ø§Ù„ØªØµÙ†ÙŠÙ: ${cat}
- Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª: Ù„Ø§ ÙŠÙ‚Ù„ Ø¹Ù† ${wc} ÙƒÙ„Ù…Ø©
${kwSection}

âœï¸ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© (Ø¥Ù„Ø²Ø§Ù…ÙŠØ©):
- Ø§ÙƒØªØ¨ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø¥Ù†Ø³Ø§Ù†ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ 100% â€” ÙƒØ£Ù† ÙƒØ§ØªØ¨Ø§Ù‹ Ø­Ù‚ÙŠÙ‚ÙŠØ§Ù‹ ÙŠÙÙƒØ± ÙˆÙŠØ­ÙƒÙŠ
- Ø¬Ù…Ù„ Ù…ØªÙØ§ÙˆØªØ© Ø§Ù„Ø·ÙˆÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ ÙˆØ§Ù„Ø·ÙˆÙŠÙ„Ø© Ù†Ø³Ø¨ÙŠØ§Ù‹
- ÙÙ‚Ø±Ø§Øª Ù‚ØµÙŠØ±Ø© (3-4 Ø£Ø³Ø·Ø± ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)
- Ù„Ø§ Ø­Ø´Ùˆ ÙˆÙ„Ø§ ØªÙƒØ±Ø§Ø± â€” ÙƒÙ„ Ø¬Ù…Ù„Ø© ØªØ¶ÙŠÙ Ù‚ÙŠÙ…Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©
- ØªÙ†ÙˆÙ‘Ø¹ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙÙ‚Ø±Ø§Øª â€” Ù„Ø§ ØªØ¨Ø¯Ø£ ÙƒÙ„Ù‡Ø§ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©
- Ù…Ø³Ù…ÙˆØ­ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø¹ÙÙˆÙŠ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø­ÙŠØ§Ù†Ø§Ù‹
- Ø±Ø£ÙŠ Ø´Ø®ØµÙŠ ÙˆØªØ¬Ø±Ø¨Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©

ğŸ”’ Ø´Ø±ÙˆØ· Google AdSense (Ø¥Ù„Ø²Ø§Ù…ÙŠØ©):
- Ù…Ø­ØªÙˆÙ‰ Ù…ÙÙŠØ¯ ÙˆØ¢Ù…Ù† ÙˆØºÙŠØ± Ù…Ø¶Ù„Ù„ ØªÙ…Ø§Ù…Ø§Ù‹
- Ø¨Ø¯ÙˆÙ† Ø¹Ù†Ø§ÙˆÙŠÙ† Clickbait Ø£Ùˆ ÙˆØ¹ÙˆØ¯ Ø²Ø§Ø¦ÙØ©
- Ù„Ø§ ØªØ­Ø« Ø¹Ù„Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
- Ù„Ø§ ØªØ°ÙƒØ± Google AdSense Ø£Ùˆ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª

ğŸ“ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ HTML Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
- <h1>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</h1> â€” Ù„Ø§ ÙŠØ²ÙŠØ¯ Ø¹Ù† 65 Ø­Ø±ÙØ§Ù‹
- <h2 style="color:red;">Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ÙØ±Ø¹ÙŠØ©</h2>
- <h3 style="color:darkblue;">Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©</h3>
- ÙÙ‚Ø±Ø§Øª Ø¨Ù€ <p> ÙÙ‚Ø·
- Ù‚ÙˆØ§Ø¦Ù… Ø¨Ù€ <ul><li> Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©

ğŸ§¾ Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©:
1. Ù…Ù‚Ø¯Ù…Ø© Ù‚ØµÙŠØ±Ø© ØªØ¬ÙŠØ¨ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù† Ù†ÙŠØ© Ø§Ù„Ø¨Ø­Ø«
2. Ù‚Ø³Ù… H2: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… ${topic}" â€” Ø®Ø·ÙˆØ§Øª Ù…Ø¨Ø³Ø·Ø© Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†
${cmpSection}
${faqSection}
${fixSection}
${vidSection}
3. Ù‚Ø³Ù… H2 Ù„Ù„ØªØ­Ù…ÙŠÙ„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ© + ÙƒÙ„Ù…Ø© Ù…Ø´ÙˆÙ‘Ù‚Ø© ØºÙŠØ± Ù…Ø¶Ù„Ù„Ø©
4. Ø¨Ø¹Ø¯ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„: Ø³Ø·Ø± Ù‚ØµÙŠØ± ÙŠÙˆØ¶Ø­ Ø£Ù† Ø§Ù„Ù…ØµØ¯Ø± Ø±Ø³Ù…ÙŠ ÙˆØ¢Ù…Ù†
5. Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø§Ù„Ø¶Ø¨Ø· (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·):

<div style="text-align:center; margin:25px 0;">
  <a href="${dlLink}" style="display:inline-block;padding:16px 34px;background:linear-gradient(135deg,#1e88e5,#42a5f5);color:#ffffff;font-size:18px;font-weight:600;border-radius:12px;text-decoration:none;box-shadow:0 6px 18px rgba(30,136,229,0.35);">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ ${topic} Ø§Ù„Ø¢Ù†</a>
</div>

${relSection}
6. Ø®Ø§ØªÙ…Ø© Ø¨Ù†ØµÙŠØ­Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø­Ø§ÙŠØ¯Ø© ØªØ³Ø§Ø¹Ø¯ Ø§Ù„Ù‚Ø§Ø±Ø¦ Ø¹Ù„Ù‰ Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ù…Ù†Ø§Ø³Ø¨ Ù„Ù‡

Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‚Ø§Ù„ HTML Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØ¹Ù„ÙŠÙ‚ Ø£Ùˆ Ø´Ø±Ø­ Ù…Ù†Ùƒ.${seoReq}`;
}

/* ============================
   RENDER
============================= */
function showLoader(isAdv){
  const color = isAdv ? 'purple' : '';
  document.getElementById('artview').innerHTML = `
    <div class="loader">
      <div class="lring ${color}"></div>
      <div class="lmsg">${isAdv ? 'âš¡ ØªÙˆÙ„ÙŠØ¯ Ù…Ù‚Ø§Ù„ AdSense Ø§Ø­ØªØ±Ø§ÙÙŠ...' : '// OpenRouter ÙŠÙƒØªØ¨ Ù…Ù‚Ø§Ù„Ùƒ Ù…Ø¬Ø§Ù†Ø§Ù‹...'}</div>
      <div class="lprog">
        <div class="lpstep done"><div class="dot"></div><span style="color:var(--text3);">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</span></div>
        <div class="lpstep active"><div class="dot"></div><span style="color:var(--text2);">${isAdv ? 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©' : 'ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰'}</span></div>
        <div class="lpstep"><div class="dot"></div><span>${isAdv ? 'SEO + AdSense Safety' : 'ØªØ­Ø³ÙŠÙ† SEO'}</span></div>
        <div class="lpstep"><div class="dot"></div><span>ØªÙ†Ø³ÙŠÙ‚ HTML</span></div>
      </div>
      <div class="lsub">// Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø­ØªÙ‰ 30 Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</div>
    </div>`;
}

function renderArticle(text){
  const av = document.getElementById('artview');
  if(viewMode==='raw'){
    av.innerHTML = `<pre style="font-family:var(--mono);font-size:11px;color:var(--text2);white-space:pre-wrap;line-height:1.7;overflow-x:auto;">${escHtml(text)}</pre>`;
    return;
  }
  if(viewMode==='txt'){
    const stripped = text.replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim();
    av.innerHTML = `<div style="font-size:13px;color:var(--text2);line-height:1.9;white-space:pre-wrap;">${stripped}</div>`;
    return;
  }
  
  // Preview â€” render HTML
  if(text.trim().startsWith('<')){
    let rendered = text;
    
    // Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©
    if(generatedImages.first && generatedImages.middle){
      // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨Ø¹Ø¯ H1 Ù…Ø¨Ø§Ø´Ø±Ø©
      rendered = rendered.replace(
        /<\/h1>/i,
        `</h1><img src="${generatedImages.first}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" style="width:100%;border-radius:12px;margin:16px 0;box-shadow:0 4px 12px rgba(0,0,0,.1);" loading="lazy">`
      );
      
      // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ù…Ù‚Ø§Ù„ â€” Ø¨Ø¹Ø¯ Ù†Øµ H2 ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹
      const h2Match = rendered.match(/<\/h2>/gi);
      if(h2Match && h2Match.length >= 2){
        // Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠ H2
        let count = 0;
        rendered = rendered.replace(/<\/h2>/gi, (match)=>{
          count++;
          if(count === 2){
            return `</h2><img src="${generatedImages.middle}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰" style="width:100%;border-radius:12px;margin:16px 0;box-shadow:0 4px 12px rgba(0,0,0,.1);" loading="lazy">`;
          }
          return match;
        });
      } else {
        // Ù„Ùˆ Ù…ÙÙŠØ´ H2 ÙƒÙØ§ÙŠØ©ØŒ Ø­Ø·Ù‡Ø§ Ù‚Ø¨Ù„ Ø¢Ø®Ø± ÙÙ‚Ø±Ø©
        const lastP = rendered.lastIndexOf('</p>');
        if(lastP > 0){
          rendered = rendered.slice(0,lastP) + 
            `<img src="${generatedImages.middle}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰" style="width:100%;border-radius:12px;margin:16px 0;box-shadow:0 4px 12px rgba(0,0,0,.1);" loading="lazy">` +
            rendered.slice(lastP);
        }
      }
    }
    // Ù„Ùˆ ØµÙˆØ±Ø© Unsplash Ù…Ø®ØªØ§Ø±Ø© ÙˆØµÙˆØ± AI Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø©
    else if(selectedImg && !generatedImages.first){
      rendered = rendered.replace(
        /<\/h1>/i,
        `</h1><img src="${selectedImg}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„" style="width:100%;border-radius:10px;margin:14px 0;max-height:220px;object-fit:cover;">`
      );
    }
    
    av.innerHTML = rendered;
  } else {
    // Convert markdown-like
    let html = text
      .replace(/^# (.+)$/gm,'<h1>$1</h1>')
      .replace(/^## (.+)$/gm,'<h2 style="color:red;">$1</h2>')
      .replace(/^### (.+)$/gm,'<h3 style="color:darkblue;">$1</h3>')
      .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
      .replace(/\*(.+?)\*/g,'<em>$1</em>')
      .replace(/^- (.+)$/gm,'<li>$1</li>')
      .replace(/(<li>.*<\/li>\n?)+/g,m=>`<ul>${m}</ul>`)
      .replace(/^(?!<[hHuUlLoObBpP]).+$/gm,m=>m.trim()?`<p>${m}</p>`:'');
    if(selectedImg) html = html.replace('</h1>',`</h1><img src="${selectedImg}" alt="ØµÙˆØ±Ø©" style="width:100%;border-radius:10px;margin:14px 0;max-height:220px;object-fit:cover;">`);
    av.innerHTML = html;
  }
}

function switchView(mode){
  viewMode=mode;
  ['prev','raw','txt'].forEach(t=>{
    document.getElementById('tab-'+t).classList.toggle('on', t===mode.replace('preview','prev'));
  });
  if(currentArticle) renderArticle(currentArticle);
}

/* ============================
   SEO
============================= */
function renderSEO(seo){
  document.getElementById('seocard').classList.add('shown');
  document.getElementById('seo-t').textContent = seo.title||'â€”';
  document.getElementById('seo-d').textContent = seo.description||'â€”';
  document.getElementById('seo-k').textContent = getKeywords().join('ØŒ ')||'â€”';
  const sc = seo.score||80;
  document.getElementById('seoring').textContent = sc+'%';
  document.getElementById('ss').textContent = sc+'%';
  document.getElementById('sb-seo').style.display='flex';
}

/* ============================
   STATS
============================= */
function updateStats(text){
  const stripped = text.replace(/<[^>]+>/g,' ');
  const words = stripped.split(/\s+/).filter(Boolean).length;
  const chars = stripped.length;
  document.getElementById('sw').textContent = words.toLocaleString('ar');
  document.getElementById('sc').textContent = chars.toLocaleString('ar');
  document.getElementById('sr').textContent = Math.ceil(words/200);
}

/* ============================
   AUTO AI IMAGES + LOGO â€” ØªÙ„Ù‚Ø§Ø¦ÙŠ
============================= */
let generatedImages = { first: null, middle: null };

async function autoGenerateImagesWithLogo(topic){
  if(!logoDataUrl){
    toast('âš ï¸ Ø§Ø±ÙØ¹ Ù„ÙˆØ¬Ùˆ Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø£ÙˆÙ„Ø§Ù‹', true);
    return;
  }

  toast('ğŸ¨ Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±ØªÙŠÙ† Ø¨Ø§Ù„Ù€ AI + Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆØ¬Ùˆ...');
  
  const seed1 = Math.floor(Math.random()*99999);
  const seed2 = Math.floor(Math.random()*99999);
  const p1 = encodeURIComponent(`${topic}, professional blog header, modern flat design, vibrant colors, 4k`);
  const p2 = encodeURIComponent(`${topic}, digital illustration, clean editorial style, high quality photography`);
  const url1 = `https://image.pollinations.ai/prompt/${p1}?width=1200&height=630&seed=${seed1}&nologo=true`;
  const url2 = `https://image.pollinations.ai/prompt/${p2}?width=1200&height=630&seed=${seed2}&nologo=true`;

  try {
    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ø¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ
    generatedImages.first = await addLogoToImageURL(url1);
    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù…Ø¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ
    generatedImages.middle = await addLogoToImageURL(url2);
    
    toast('âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±ØªÙŠÙ† + Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆØ¬Ùˆ â€” ØªÙ… Ø¥Ø¯Ø±Ø§Ø¬Ù‡Ù… ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„');
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    if(currentArticle) renderArticle(currentArticle);
    
  } catch(e){
    toast('âŒ ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ± â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', true);
  }
}

async function addLogoToImageURL(imgURL){
  return new Promise((resolve, reject)=>{
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    const mainImg = new Image();
    mainImg.crossOrigin = 'anonymous';
    mainImg.onload = ()=>{
      canvas.width = 1200;
      canvas.height = 630;
      ctx.drawImage(mainImg, 0, 0, canvas.width, canvas.height);
      
      const logoImg = new Image();
      logoImg.onload = ()=>{
        // Ù„ÙˆØ¬Ùˆ ÙÙŠ Ø£Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ† â€” 20% Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©
        const logoW = canvas.width * 0.20;
        const logoH = (logoImg.naturalHeight / logoImg.naturalWidth) * logoW;
        const pad = canvas.width * 0.025;
        const x = canvas.width - logoW - pad;
        const y = pad;
        
        ctx.globalAlpha = 0.88;
        ctx.drawImage(logoImg, x, y, logoW, logoH);
        ctx.globalAlpha = 1;
        
        // ØªØ­ÙˆÙŠÙ„ Ù„Ù€ WebP
        const webpDataURL = canvas.toDataURL('image/webp', 0.92);
        resolve(webpDataURL);
      };
      logoImg.onerror = ()=> reject('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ÙˆØ¬Ùˆ');
      logoImg.src = logoDataUrl;
    };
    mainImg.onerror = ()=> reject('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©');
    mainImg.src = imgURL;
  });
}


let logoDataUrl = null;
document.addEventListener('DOMContentLoaded', ()=>{
  const lf = document.getElementById('logo-file');
  if(lf) lf.addEventListener('change', function(){
    const file = this.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      logoDataUrl = e.target.result;
      document.getElementById('logo-img').src = logoDataUrl;
      document.getElementById('logo-preview').style.display = 'block';
      toast('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ');
    };
    reader.readAsDataURL(file);
  });
});

/* ============================
   IMAGE TABS
============================= */
function switchImgTab(tab){
  document.getElementById('img-unsplash-sec').style.display = tab==='unsplash'?'block':'none';
  document.getElementById('img-ai-sec').style.display       = tab==='ai'      ?'block':'none';
  document.getElementById('img-tab-unsplash').classList.toggle('on', tab==='unsplash');
  document.getElementById('img-tab-ai').classList.toggle('on', tab==='ai');
}

/* ============================
   AI IMAGE GENERATION â€” Pollinations Ù…Ø¬Ø§Ù†ÙŠ
============================= */
async function generateAIImages(){
  const topic = document.getElementById('topic').value.trim() || 'technology digital';
  const btn = document.getElementById('gen-ai-imgs-btn');
  const grid = document.getElementById('ai-imggrid');
  btn.disabled = true; btn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...';
  grid.innerHTML = `<div style="color:var(--text3);font-size:11px;grid-column:1/-1;text-align:center;padding:24px;font-family:var(--mono);">// Pollinations AI ÙŠØ±Ø³Ù… ØµÙˆØ±ØªÙŠÙ† â€” Ø§Ù†ØªØ¸Ø± 10-20 Ø«Ø§Ù†ÙŠØ©...</div>`;

  const s1 = Math.floor(Math.random()*99999);
  const s2 = Math.floor(Math.random()*99999);
  const p1 = encodeURIComponent(`${topic}, professional blog cover, modern flat design, vibrant colors, 4k quality`);
  const p2 = encodeURIComponent(`${topic}, digital illustration, clean minimalist editorial style, high quality photography`);
  const url1 = `https://image.pollinations.ai/prompt/${p1}?width=1200&height=630&seed=${s1}&nologo=true`;
  const url2 = `https://image.pollinations.ai/prompt/${p2}?width=1200&height=630&seed=${s2}&nologo=true`;

  grid.innerHTML = [url1,url2].map((u,i)=>`
    <div class="imgopt" id="aio-${i}" onclick="pickAIImg('${u}',${i})"
      style="aspect-ratio:16/9;opacity:.4;transition:opacity .8s;">
      <img src="${u}" alt="AI ${i+1}" style="width:100%;height:100%;object-fit:cover;"
        onload="document.getElementById('aio-${i}').style.opacity=1"
        onerror="document.getElementById('aio-${i}').innerHTML='<div style=\\'padding:14px;color:var(--rose);font-size:10px;text-align:center;\\'>âŒ ÙØ´Ù„ Ø§Ù„ØªÙˆÙ„ÙŠØ¯</div>'">
      <div class="imgchk">âœ“ Ù…Ø®ØªØ§Ø±</div>
    </div>`).join('');

  btn.disabled=false; btn.innerHTML='ğŸ”„ ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±ØªÙŠÙ† Ø¬Ø¯ÙŠØ¯ØªÙŠÙ†';
}

function pickAIImg(url,idx){
  document.querySelectorAll('#ai-imggrid .imgopt').forEach(e=>e.classList.remove('chosen'));
  const el=document.getElementById('aio-'+idx); if(el) el.classList.add('chosen');
  applyLogoToImage(url);
}

/* ============================
   IMAGES â€” Unsplash
============================= */
async function loadImages(topic){
  const g = document.getElementById('imggrid');
  g.innerHTML=`<div style="color:var(--text3);font-size:12px;grid-column:1/-1;text-align:center;padding:20px;font-family:var(--mono);">// Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±...</div>`;
  const q = encodeURIComponent(topic.slice(0,50));
  const imgs = Array.from({length:6},(_,i)=>`https://source.unsplash.com/featured/800x450/?${q}&sig=${i+Date.now()}`);
  g.innerHTML = imgs.map((u,i)=>`
    <div class="imgopt" id="io-${i}" onclick="pickImg('${u}',${i})">
      <img src="${u}" alt="ØµÙˆØ±Ø© ${i+1}" loading="lazy" onerror="this.parentElement.style.display='none'">
      <div class="imgchk">âœ“ Ù…Ø®ØªØ§Ø±</div>
    </div>`).join('');
}

function pickImg(url, idx){
  selectedImg = url;
  document.querySelectorAll('#imggrid .imgopt').forEach(el=>el.classList.remove('chosen'));
  const el=document.getElementById('io-'+idx); if(el) el.classList.add('chosen');
  applyLogoToImage(url);
  if(currentArticle) renderArticle(currentArticle);
}

/* ============================
   CANVAS â€” Ù„ÙˆØ¬Ùˆ ÙÙˆÙ‚ Ø§Ù„ØµÙˆØ±Ø©
============================= */
function applyLogoToImage(imgUrl){
  const canvas = document.getElementById('img-canvas');
  const ctx = canvas.getContext('2d');
  document.getElementById('img-result-sec').style.display='block';
  setTimeout(()=>canvas.scrollIntoView({behavior:'smooth',block:'nearest'}),200);

  const mainImg = new Image();
  mainImg.crossOrigin='anonymous';
  mainImg.onload=()=>{
    canvas.width  = mainImg.naturalWidth  || 1200;
    canvas.height = mainImg.naturalHeight || 630;
    ctx.drawImage(mainImg,0,0,canvas.width,canvas.height);

    if(!logoDataUrl){
      selectedImg = canvas.toDataURL('image/webp',0.92);
      toast('âš ï¸ Ø§Ø±ÙØ¹ Ù„ÙˆØ¬Ùˆ Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ù„Ø¥Ø¶Ø§ÙØªÙ‡');
      return;
    }
    const logoImg = new Image();
    logoImg.onload=()=>{
      const pct = parseInt(document.getElementById('logo-size').value)/100;
      const lw  = canvas.width*pct;
      const lh  = (logoImg.naturalHeight/logoImg.naturalWidth)*lw;
      const pos = document.getElementById('logo-pos').value;
      const pad = Math.round(canvas.width*0.025);
      let x,y;
      if(pos==='bottom-right'){x=canvas.width-lw-pad; y=canvas.height-lh-pad;}
      else if(pos==='bottom-left'){x=pad; y=canvas.height-lh-pad;}
      else if(pos==='top-right'){x=canvas.width-lw-pad; y=pad;}
      else if(pos==='top-left'){x=pad; y=pad;}
      else{x=(canvas.width-lw)/2; y=(canvas.height-lh)/2;}
      ctx.globalAlpha=0.88;
      ctx.drawImage(logoImg,x,y,lw,lh);
      ctx.globalAlpha=1;
      selectedImg = canvas.toDataURL('image/webp',0.92);
      toast('âœ… Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§ØªØ¶Ø§Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©');
    };
    logoImg.src=logoDataUrl;
  };
  mainImg.onerror=()=>toast('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©',true);
  mainImg.src=imgUrl;
}

/* ============================
   DOWNLOAD WebP / PNG
============================= */
function downloadWebP(){
  const c=document.getElementById('img-canvas');
  if(!c.width){toast('âŒ Ø§Ø®ØªØ§Ø± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹',true);return;}
  const a=document.createElement('a');
  a.download=`blogmind-${Date.now()}.webp`;
  a.href=c.toDataURL('image/webp',0.92); a.click();
  toast('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ WebP');
}
function downloadPNG(){
  const c=document.getElementById('img-canvas');
  if(!c.width){toast('âŒ Ø§Ø®ØªØ§Ø± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹',true);return;}
  const a=document.createElement('a');
  a.download=`blogmind-${Date.now()}.png`;
  a.href=c.toDataURL('image/png'); a.click();
  toast('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ PNG');
}
function useInArticle(){
  const c=document.getElementById('img-canvas');
  if(!c.width){toast('âŒ Ø§Ø®ØªØ§Ø± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹',true);return;}
  selectedImg=c.toDataURL('image/webp',0.92);
  if(currentArticle) renderArticle(currentArticle);
  toast('âœ… Ø§Ù„ØµÙˆØ±Ø© Ø£ÙØ¶ÙŠÙØª Ù„Ù„Ù…Ù‚Ø§Ù„');
}



/* ============================
   PUBLISH
============================= */
async function pubNow(){
  if(!currentArticle){ toast('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„',true); return; }
  const cfg=getCfg();
  if(!cfg.bid||!cfg.tok){ toast('âŒ Ø£Ø¯Ø®Ù„ Blog ID Ùˆ Access Token',true); return; }
  openModal('ğŸš€ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ø´Ø±', `Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø±ØŸ<br><small style="font-family:var(--mono);color:var(--text3);">// ${document.getElementById('topic').value.slice(0,60)}</small>`, ()=>doPublish(cfg));
}

async function schedPub(){
  const tv = document.getElementById('sched-dt').value;
  if(!tv){ toast('âŒ Ø­Ø¯Ø¯ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ø´Ø±',true); return; }
  const sd = new Date(tv);
  if(sd<=new Date()){ toast('âŒ Ø§Ù„Ù…ÙˆØ¹Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„',true); return; }
  openModal('ğŸ• ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©',`Ø§Ù„Ù†Ø´Ø± ÙÙŠ: <b style="color:var(--amber)">${sd.toLocaleString('ar-EG')}</b>`, ()=>{
    toast(`âœ… ØªÙ…Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© â€” ${Math.round((sd-Date.now())/60000)} Ø¯Ù‚ÙŠÙ‚Ø©`);
    saveToHistory('Ù…Ø¬Ø¯ÙˆÙ„');
    setTimeout(()=>{ const cfg=getCfg(); doPublish(cfg,true); }, sd-Date.now());
  });
}

async function doPublish(cfg, isScheduled=false){
  const pb = document.getElementById('pub-btn');
  pb.disabled=true; pb.textContent='â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';
  const title = currentSEO?.title || document.getElementById('topic').value;
  const content = buildFinalHTML();
  const labels = [document.getElementById('cat').value].filter(Boolean);
  try {
    const res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${cfg.bid}/posts/`,{
      method:'POST',
      headers:{'Authorization':`Bearer ${cfg.tok}`,'Content-Type':'application/json'},
      body:JSON.stringify({title,content,labels})
    });
    if(!res.ok){ const e=await res.json(); throw new Error(e.error?.message||`HTTP ${res.status}`); }
    const data=await res.json();
    saveToHistory('Ù…Ù†Ø´ÙˆØ±', data.url);
    toast('ğŸ‰ ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø± Ø¨Ù†Ø¬Ø§Ø­!');
    if(data.url) setTimeout(()=>window.open(data.url,'_blank'),1200);
  } catch(err){ toast('âŒ '+err.message,true); }
  finally{ pb.disabled=false; pb.innerHTML='ğŸš€ Ù†Ø´Ø± Ø¹Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø±'; }
}

function buildFinalHTML(){
  if(!currentArticle) return '';
  let content = currentArticle;
  
  // ØªØ­ÙˆÙŠÙ„ markdown Ù„Ùˆ Ù…Ø´ HTML
  if(!content.trim().startsWith('<')){
    content = content
      .replace(/^# (.+)$/gm,'<h1>$1</h1>')
      .replace(/^## (.+)$/gm,'<h2 style="color:red;">$1</h2>')
      .replace(/^### (.+)$/gm,'<h3 style="color:darkblue;">$1</h3>')
      .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
      .replace(/\*(.+?)\*/g,'<em>$1</em>')
      .replace(/^- (.+)$/gm,'<li>$1</li>')
      .replace(/(<li>.*<\/li>\n?)+/g,m=>`<ul>${m}</ul>`)
      .replace(/^(?!<[hHuUlLoObBpP]).+$/gm,m=>m.trim()?`<p>${m}</p>`:'');
  }
  
  // Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙÙŠ Ù…ÙƒØ§Ù†ÙŠÙ†
  if(generatedImages.first && generatedImages.middle){
    // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨Ø¹Ø¯ H1
    content = content.replace(
      /<\/h1>/i,
      `</h1><img src="${generatedImages.first}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" style="width:100%;border-radius:12px;margin:16px 0;box-shadow:0 4px 12px rgba(0,0,0,.08);" loading="lazy">`
    );
    
    // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
    const h2Match = content.match(/<\/h2>/gi);
    if(h2Match && h2Match.length >= 2){
      let count = 0;
      content = content.replace(/<\/h2>/gi, (match)=>{
        count++;
        if(count === 2){
          return `</h2><img src="${generatedImages.middle}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰" style="width:100%;border-radius:12px;margin:16px 0;box-shadow:0 4px 12px rgba(0,0,0,.08);" loading="lazy">`;
        }
        return match;
      });
    }
  } else if(selectedImg && !generatedImages.first){
    // ØµÙˆØ±Ø© Unsplash ÙÙ‚Ø·
    content = content.replace('</h1>',`</h1><img src="${selectedImg}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„" style="width:100%;border-radius:12px;margin:16px 0;max-height:380px;object-fit:cover;">`);
  }
  
  const style = `<style>body,div,p,h1,h2,h3,li{font-family:'Tajawal',Arial,sans-serif;line-height:1.9;}
p{margin-bottom:15px;font-size:16px;color:#222;}
h1{color:#1565c0;font-size:28px;margin-bottom:18px;}
h2{font-size:22px;margin:26px 0 12px;}
h3{font-size:18px;margin:18px 0 8px;}
ul{margin:10px 0 14px 22px;} li{margin-bottom:6px;font-size:16px;}
strong{color:#bf360c;} blockquote{border-right:4px solid #1565c0;padding:10px 16px;background:#e3f2fd;margin:16px 0;border-radius:0 8px 8px 0;}
img{width:100%;border-radius:10px;margin:14px 0;}</style>`;
  return style + content;
}
ul{margin:10px 0 14px 22px;} li{margin-bottom:6px;font-size:16px;}
strong{color:#bf360c;} blockquote{border-right:4px solid #1565c0;padding:10px 16px;background:#e3f2fd;margin:16px 0;border-radius:0 8px 8px 0;}
img{width:100%;border-radius:10px;margin:14px 0;}</style>`;
  return style + content;
}

/* ============================
   HISTORY
============================= */
function saveToHistory(status, url){
  const entry = {
    id: Date.now().toString(),
    title: currentSEO?.title || document.getElementById('topic').value,
    url: url||null,
    topic: document.getElementById('topic').value,
    date: new Date().toLocaleDateString('ar-EG'),
    status,
    words: document.getElementById('sw').textContent,
    adv: advMode
  };
  history.unshift(entry);
  localStorage.setItem('bm_hist', JSON.stringify(history.slice(0,50)));
}

function renderHistory(){
  const el = document.getElementById('hist-render');
  if(!history.length){
    el.innerHTML=`<div style="text-align:center;padding:60px;color:var(--text3);font-family:var(--mono);">// Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø¨Ø¹Ø¯</div>`;
    return;
  }
  el.innerHTML = history.map(h=>`
    <div class="hcard" onclick="${h.url?`window.open('${h.url}','_blank')`:''}">
      <div>
        <div class="htitle">${h.title} ${h.adv?'<span style="font-size:9px;color:var(--purple);background:rgba(179,136,255,.1);padding:1px 5px;border-radius:3px;font-family:var(--mono);">ADV</span>':''}</div>
        <div class="hmeta">
          <span>ğŸ“… ${h.date}</span><span>ğŸ“ ${h.words} ÙƒÙ„Ù…Ø©</span>
          ${h.url?`<span style="color:var(--cyan)">â†— ÙØªØ­</span>`:''}
        </div>
      </div>
      <span class="badge ${h.status==='Ù…Ù†Ø´ÙˆØ±'?'bp':h.status==='Ù…Ø¬Ø¯ÙˆÙ„'?'bs':'bd'}">${h.status}</span>
    </div>`).join('');
}

/* ============================
   ACTIONS
============================= */
function copyArt(){
  if(!currentArticle) return;
  const content = viewMode==='html'||viewMode==='raw' ? currentArticle : buildFinalHTML();
  navigator.clipboard.writeText(currentArticle).then(()=>toast('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø­ØªÙˆÙ‰'));
}

function dlArt(){
  if(!currentArticle) return;
  const html = `<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><title>Ù…Ù‚Ø§Ù„</title></head><body>${buildFinalHTML()}</body></html>`;
  const blob = new Blob([html],{type:'text/html'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `article-${Date.now()}.html`;
  a.click();
  toast('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù');
}

/* ============================
   MODAL
============================= */
function openModal(title, body, ok){
  document.getElementById('m-title').textContent=title;
  document.getElementById('m-body').innerHTML=body;
  document.getElementById('modal').classList.add('open');
  document.getElementById('m-ok').onclick=()=>{ closeModal(); if(ok) ok(); };
}
function closeModal(){ document.getElementById('modal').classList.remove('open'); }
document.getElementById('modal').addEventListener('click',e=>{ if(e.target===e.currentTarget) closeModal(); });

/* ============================
   VERIFY ALL KEYS â€” Ù†Ø³Ø®Ø© Ù…ØµØ­Ø­Ø©
============================= */
function setVRow(key, state, icon, detail, status) {
  const row = document.getElementById('v-'+key);
  const iEl = document.getElementById('vi-'+key);
  const dEl = document.getElementById('vd-'+key);
  const sEl = document.getElementById('vs-'+key);
  if(!row) return;
  row.className = 'vrow ' + state;
  iEl.textContent = icon;
  dEl.textContent = detail;
  sEl.textContent = status;
  sEl.style.color = state==='ok' ? 'var(--green)' : state==='fail' ? 'var(--rose)' : 'var(--amber)';
}

async function verifyAll() {
  const cfg = getCfg();
  const btn = document.getElementById('verify-btn');
  btn.disabled = true;
  btn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';

  const card = document.getElementById('verify-card');
  card.style.display = 'block';
  card.scrollIntoView({ behavior:'smooth', block:'nearest' });

  // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ
  ['api','bid','tok'].forEach(k => setVRow(k,'checking','â³','Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙØ¹Ù„ÙŠ...','...'));
  document.getElementById('verify-summary').style.display = 'none';
  document.getElementById('verify-overall').textContent = '';

  let okApi = false, okBid = false, okTok = false;

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1) OpenRouter API Key
  //    Ø¨ÙŠØ¨Ø¹Øª request Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆÙŠØ´ÙˆÙ Ø§Ù„Ø±Ø¯
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if (!cfg.ak || cfg.ak.trim() === '') {
    setVRow('api','fail','âŒ','Ø§Ù„Ø®Ø§Ù†Ø© ÙØ§Ø±ØºØ© â€” Ø£Ø¯Ø®Ù„ OpenRouter API Key','ÙØ§Ø±Øº âŒ');
  } else {
    try {
      const r = await fetch('https://openrouter.ai/api/v1/auth/key', {
        headers: { 'Authorization': 'Bearer ' + cfg.ak.trim() }
      });
      if (r.ok) {
        const d = await r.json();
        const label = d.data?.label || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
        const usage = d.data?.usage !== undefined ? `Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: $${Number(d.data.usage).toFixed(4)}` : '';
        setVRow('api','ok','âœ…', `Ø§Ù„Ù…ÙØªØ§Ø­ ØµØ­ÙŠØ­ âœ… â€” Ø§Ù„Ø§Ø³Ù…: "${label}" ${usage}`, 'Ø´ØºÙ‘Ø§Ù„ âœ…');
        okApi = true;
      } else if (r.status === 401) {
        setVRow('api','fail','âŒ','Ø§Ù„Ù…ÙØªØ§Ø­ Ø®Ø§Ø·Ø¦ Ø£Ùˆ Ù…Ø­Ø°ÙˆÙ â€” Ø§Ø¹Ù…Ù„ Ù…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯ Ù…Ù† openrouter.ai/keys','Ø®Ø§Ø·Ø¦ âŒ');
      } else {
        setVRow('api','fail','âš ï¸','Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: HTTP ' + r.status,'Ø®Ø·Ø£ âš ï¸');
      }
    } catch(e) {
      setVRow('api','fail','âŒ','ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ OpenRouter â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª','ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ âŒ');
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2) Blog ID + Access Token Ù…Ø¹Ø§Ù‹
  //    Ø¨ÙŠØ¨Ø¹Øª request Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù€ Blogger API
  //    Ø¯Ù‡ Ø§Ù„ÙØ­Øµ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø§Ù„ØµØ­ Ù„Ù„Ø§ØªÙ†ÙŠÙ†
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const bid = (cfg.bid || '').trim();
  const tok = (cfg.tok || '').trim();

  // ÙØ­Øµ Blog ID â€” Ø´ÙƒÙ„ ÙÙ‚Ø· Ø£ÙˆÙ„Ø§Ù‹
  if (!bid) {
    setVRow('bid','fail','âŒ','Ø§Ù„Ø®Ø§Ù†Ø© ÙØ§Ø±ØºØ© â€” Ø£Ø¯Ø®Ù„ Blog ID','ÙØ§Ø±Øº âŒ');
  } else if (!/^\d+$/.test(bid)) {
    setVRow('bid','fail','âŒ','Blog ID Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· â€” Ù…Ø«Ø§Ù„: 1234567890123456789','Ø®Ø§Ø·Ø¦ âŒ');
  } else {
    setVRow('bid','checking','â³','Ø§Ù„Ø´ÙƒÙ„ ØµØ­ â€” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙØ¹Ù„ÙŠ Ù…Ù† Ø§Ù„Ù€ API...','...');
    okBid = true; // Ù…Ø¤Ù‚Øª â€” Ù‡ÙŠØªØ£ÙƒØ¯ Ø¨Ø¹Ø¯ÙŠÙ†
  }

  // ÙØ­Øµ Access Token â€” Ø´ÙƒÙ„ ÙÙ‚Ø· Ø£ÙˆÙ„Ø§Ù‹
  if (!tok) {
    setVRow('tok','fail','âŒ','Ø§Ù„Ø®Ø§Ù†Ø© ÙØ§Ø±ØºØ© â€” Ø£Ø¯Ø®Ù„ Access Token','ÙØ§Ø±Øº âŒ');
  } else if (!tok.startsWith('ya29.')) {
    setVRow('tok','fail','âŒ','Ø§Ù„ØªÙˆÙƒÙ† Ù„Ø§Ø²Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€ ya29. â€” Ø§Ø¬ÙŠØ¨Ù‡ Ù…Ù† OAuth Playground','Ø®Ø§Ø·Ø¦ Ø§Ù„Ø´ÙƒÙ„ âŒ');
  } else {
    setVRow('tok','checking','â³','Ø§Ù„Ø´ÙƒÙ„ ØµØ­ â€” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙØ¹Ù„ÙŠ Ù…Ù† Ø§Ù„Ù€ API...','...');
  }

  // Ù„Ùˆ Ø§Ù„Ø§ØªÙ†ÙŠÙ† Ø´ÙƒÙ„Ù‡Ù… ØµØ­ â€” Ù†Ø¹Ù…Ù„ ÙØ­Øµ Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆØ§Ø­Ø¯ Ø¨ÙŠØ£ÙƒØ¯ Ø§Ù„Ø§ØªÙ†ÙŠÙ†
  if (okBid && tok.startsWith('ya29.')) {
    try {
      const r = await fetch(
        `https://www.googleapis.com/blogger/v3/blogs/${bid}`,
        { headers: { 'Authorization': 'Bearer ' + tok } }
      );

      if (r.ok) {
        const d = await r.json();
        const blogName = d.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        const blogUrl  = d.url  || '';
        // Ø§Ù„Ø§ØªÙ†ÙŠÙ† ØµØ­
        setVRow('bid','ok','âœ…', `Blog ID ØµØ­ÙŠØ­ âœ… â€” Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©: "${blogName}"`, 'ØµØ­ÙŠØ­ âœ…');
        setVRow('tok','ok','âœ…', `Ø§Ù„ØªÙˆÙƒÙ† Ø´ØºÙ‘Ø§Ù„ âœ… â€” ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©: ${blogUrl}`, 'Ø´ØºÙ‘Ø§Ù„ âœ…');
        okBid = true;
        okTok = true;

      } else if (r.status === 401) {
        // Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù†ØªÙ‡ÙŠ Ø£Ùˆ ØºÙ„Ø· â€” Blog ID Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† ØµØ­
        setVRow('bid','ok','âœ…', `Ø´ÙƒÙ„ Blog ID ØµØ­ÙŠØ­ â€” Ù„ÙƒÙ† Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù†ØªÙ‡ÙŠ ÙÙ…Ø´ Ù‚Ø§Ø¯Ø± Ù†Ø£ÙƒØ¯`, 'ÙŠØ¨Ø¯Ùˆ ØµØ­ âš ï¸');
        setVRow('tok','fail','âŒ',
          'Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (HTTP 401) â€” Ø±ÙˆØ­ OAuth Playground ÙˆØ§Ø¬ÙŠØ¨ ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯',
          'Ù…Ù†ØªÙ‡ÙŠ âŒ');
        okBid = false; // Ù…Ø´ Ù…Ø£ÙƒØ¯
        okTok = false;

      } else if (r.status === 403) {
        setVRow('bid','ok','âœ…', 'Blog ID ÙŠØ¨Ø¯Ùˆ ØµØ­ÙŠØ­', 'ÙŠØ¨Ø¯Ùˆ ØµØ­ âœ…');
        setVRow('tok','fail','âŒ',
          'Ø§Ù„ØªÙˆÙƒÙ† Ù…Ø´ Ø¹Ù†Ø¯Ù‡ ØµÙ„Ø§Ø­ÙŠØ© Blogger â€” ÙÙŠ OAuth Playground ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø§Ø®ØªØ±Øª: https://www.googleapis.com/auth/blogger',
          'Ø¨Ø¯ÙˆÙ† ØµÙ„Ø§Ø­ÙŠØ© âŒ');
        okBid = true;
        okTok = false;

      } else if (r.status === 404) {
        setVRow('bid','fail','âŒ',
          'Blog ID Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø¨Ù„ÙˆØ¬Ø± (HTTP 404) â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ø±Ø© ØªØ§Ù†ÙŠØ©',
          'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ âŒ');
        setVRow('tok','checking','âš ï¸',
          'Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† ØµØ­ â€” Ø¨Ø³ Ù…Ø´ Ù‚Ø§Ø¯Ø± Ù†ØªØ­Ù‚Ù‚ Ù„Ø£Ù† Blog ID ØºÙ„Ø·',
          'ØºÙŠØ± Ù…Ø£ÙƒØ¯ âš ï¸');
        okBid = false;
        okTok = false;

      } else {
        const errTxt = await r.text().catch(()=>'');
        setVRow('bid','fail','âš ï¸', `Ø®Ø·Ø£ HTTP ${r.status}`, 'Ø®Ø·Ø£ âš ï¸');
        setVRow('tok','fail','âš ï¸', `Ø®Ø·Ø£ HTTP ${r.status} â€” ${errTxt.slice(0,80)}`, 'Ø®Ø·Ø£ âš ï¸');
        okBid = false;
        okTok = false;
      }

    } catch(e) {
      setVRow('bid','fail','âŒ','ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Blogger API â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª','ÙØ´Ù„ âŒ');
      setVRow('tok','fail','âŒ','ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Blogger API â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª','ÙØ´Ù„ âŒ');
      okBid = false;
      okTok = false;
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªÙŠØ¬Ø©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const allOk = okApi && okBid && okTok;
  const overall = document.getElementById('verify-overall');

  if (allOk) {
    overall.textContent = 'âœ… ÙƒÙ„ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø´ØºÙ‘Ø§Ù„Ø©';
    overall.style.cssText = 'background:rgba(0,230,118,.15);color:#00e676;border:1px solid rgba(0,230,118,.3);margin-right:auto;padding:2px 10px;border-radius:10px;font-size:10px;font-family:var(--mono);';
  } else {
    overall.textContent = 'âŒ ÙÙŠ Ù…Ø´ÙƒÙ„Ø© â€” Ø´ÙˆÙ Ø§Ù„ØªÙØ§ØµÙŠÙ„';
    overall.style.cssText = 'background:rgba(255,64,129,.15);color:#ff4081;border:1px solid rgba(255,64,129,.3);margin-right:auto;padding:2px 10px;border-radius:10px;font-size:10px;font-family:var(--mono);';
  }

  const sumEl = document.getElementById('verify-summary');
  let lines = [];
  if (!okApi) lines.push('ğŸ”‘ Ø§Ø¬ÙŠØ¨ OpenRouter API Key Ø¬Ø¯ÙŠØ¯ Ù…Ù†: <b>openrouter.ai/keys</b>');
  if (!okBid) lines.push('ğŸ“° ØªØ­Ù‚Ù‚ Ù…Ù† Blog ID â€” Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø±Ø§Ø¨Ø· Ø¨Ù„ÙˆØ¬Ø±');
  if (!okTok) lines.push('ğŸ” Ø§Ø¬ÙŠØ¨ Access Token Ø¬Ø¯ÙŠØ¯ Ù…Ù†: <b>developers.google.com/oauthplayground</b> â€” ÙŠÙ†ØªÙ‡ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø©');
  if (allOk)  lines.push('ğŸ‰ ÙƒÙ„ Ø­Ø§Ø¬Ø© ØªÙ…Ø§Ù…! Ø§Ø¶ØºØ· ÙƒØªØ§Ø¨Ø© ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¢Ù†');

  sumEl.innerHTML = lines.join('<br>');
  sumEl.style.display = 'block';

  btn.disabled = false;
  btn.innerHTML = 'ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙØ§ØªÙŠØ­';

  if (allOk) toast('âœ… ÙƒÙ„ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø´ØºÙ‘Ø§Ù„Ø© ÙØ¹Ù„Ø§Ù‹ â€” Ø§Ø¨Ø¯Ø£!');
  else toast('âŒ ÙÙŠ Ù…Ø´ÙƒÙ„Ø© â€” Ø´ÙˆÙ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚', true);
}


function toast(msg, isErr=false){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.className='toast up'+(isErr?' err':'');
  setTimeout(()=>t.className='toast',3500);
}
function escHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
</script>
</body>
</html>
